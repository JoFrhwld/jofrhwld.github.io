<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.233">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Josef Fruehwald">
<meta name="dcterms.date" content="2022-09-06">

<title>Lin517: Natural Language Processing - Data Processing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../lectures/data_processing/addendum.html" rel="next">
<link href="../../lectures/data_sparsity/data_sparsity.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Data Processing</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Lin517: Natural Language Processing</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Resources</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/reading/index.html" class="sidebar-item-text sidebar-link">Reading a technical paper</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/notation/index.html" class="sidebar-item-text sidebar-link">Mathematical notation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lecture Notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Intro</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/what_is_nlp/index.html" class="sidebar-item-text sidebar-link">What is NLP?</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Data Sparsity and Processing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_sparsity/data_sparsity.html" class="sidebar-item-text sidebar-link">Data Sparsity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/index.html" class="sidebar-item-text sidebar-link active">Data processing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/addendum.html" class="sidebar-item-text sidebar-link">Data processing – addendum</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lem_stem/index.html" class="sidebar-item-text sidebar-link">Lemmatizing and stemming</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">ngrams</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/index.html" class="sidebar-item-text sidebar-link">ngram Language Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/01-ngram-eval.html" class="sidebar-item-text sidebar-link">ngrams - Perplexity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/02_smoothing.html" class="sidebar-item-text sidebar-link">ngram - Smoothing</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../lectures/word_vectors/index.html" class="sidebar-item-text sidebar-link">Word Vectors</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/01_concept.html" class="sidebar-item-text sidebar-link">Word Vectors - Concepts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/02_vectors_examples.html" class="sidebar-item-text sidebar-link">Term-Document and Term-Context matrices</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/03_word2vec.html" class="sidebar-item-text sidebar-link">word2vec</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Neural Networks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/gradient_descent/01_gradient_descent.html" class="sidebar-item-text sidebar-link">Gradient Descent</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Models</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/evaluation/index.html" class="sidebar-item-text sidebar-link">Evaluating models</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">python sessions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/00_session1.html" class="sidebar-item-text sidebar-link">Starting Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/01_session2.html" class="sidebar-item-text sidebar-link">Lists and Dictionaries</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/02_session3.html" class="sidebar-item-text sidebar-link">Loops Etc.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/03_session4.html" class="sidebar-item-text sidebar-link">Comprehensions and Useful Things</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/04_session5.html" class="sidebar-item-text sidebar-link">Making and Counting Bigrams</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#most-data-analysis-time-is-spent-on-data-wrangling" id="toc-most-data-analysis-time-is-spent-on-data-wrangling" class="nav-link active" data-scroll-target="#most-data-analysis-time-is-spent-on-data-wrangling">Most data analysis time is spent on data wrangling</a>
  <ul class="collapse">
  <li><a href="#markup-is-everywhere" id="toc-markup-is-everywhere" class="nav-link" data-scroll-target="#markup-is-everywhere">Markup is everywhere</a></li>
  </ul></li>
  <li><a href="#text-normalization" id="toc-text-normalization" class="nav-link" data-scroll-target="#text-normalization">Text Normalization</a></li>
  <li><a href="#tokenization-or-text-is-complex" id="toc-tokenization-or-text-is-complex" class="nav-link" data-scroll-target="#tokenization-or-text-is-complex">Tokenization (<em>or</em>, text is complex)</a></li>
  <li><a href="#tokenizers" id="toc-tokenizers" class="nav-link" data-scroll-target="#tokenizers">Tokenizers</a>
  <ul class="collapse">
  <li><a href="#wordlanguage-piece-based-tokenizers" id="toc-wordlanguage-piece-based-tokenizers" class="nav-link" data-scroll-target="#wordlanguage-piece-based-tokenizers">Word/language piece based tokenizers</a></li>
  <li><a href="#fixed-vocab-tokenizing" id="toc-fixed-vocab-tokenizing" class="nav-link" data-scroll-target="#fixed-vocab-tokenizing">Fixed Vocab Tokenizing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Data Processing</h1>
  <div class="quarto-categories">
    <div class="quarto-category">data</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Josef Fruehwald </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 6, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="most-data-analysis-time-is-spent-on-data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="most-data-analysis-time-is-spent-on-data-wrangling">Most data analysis time is spent on data wrangling</h2>
<p>Before we even get to substantive issues of “text normalization” and “tokenization”, we need to also deal with basic data wrangling. For example, let’s say I wanted to download 4 works from Mary Shelly from Project Gutenberg and calculate what the most common 4 word sequences in her work are, I might quickly write some code like this.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># python</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># urllib.request will download the books</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># using a dictionary just to show the title of books here in the code.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>shelley_dict <span class="op">=</span> {<span class="st">"Tales and stories"</span>: <span class="st">"https://www.gutenberg.org/cache/epub/56665/pg56665.txt"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Frankenstein"</span> : <span class="st">"https://www.gutenberg.org/files/84/84-0.txt"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"The Last Man"</span> : <span class="st">"https://www.gutenberg.org/cache/epub/18247/pg18247.txt"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Mathilda"</span> : <span class="st">"https://www.gutenberg.org/cache/epub/15238/pg15238.txt"</span>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># A collector list for all of the 4 word sequences</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>all_grams4 <span class="op">=</span> []</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over every url</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> url <span class="kw">in</span> shelley_dict.values():</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  book_dat <span class="op">=</span> urllib.request.urlopen(url)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this deals with the </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. character encoding</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. trailing whitespace</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. simplistic tokenization on spaces</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  book_lines <span class="op">=</span> [line.decode(<span class="st">"utf-8-sig"</span>).strip().split(<span class="st">" "</span>) </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> line <span class="kw">in</span> book_dat]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This flattens the list above into one long list of words</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  book_words <span class="op">=</span> [word </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> line <span class="kw">in</span> book_lines </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> word <span class="kw">in</span> line </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">len</span>(word) <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Collector list of 4grams from just this book</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  grams4 <span class="op">=</span> []</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop over every index postion up to 4 words short of the end.</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(book_words)<span class="op">-</span><span class="dv">4</span>):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># glue together 4 word sequences with "_"</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    grams4.append(<span class="st">"_"</span>.join(book_words[i:(i<span class="op">+</span><span class="dv">4</span>)]))</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add this book's 4grams to all of the books' 4grams</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  all_grams4 <span class="op">+=</span> grams4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The list <code>all_grams4</code> contains a list of every token of 4grams in these books. Let’s count them up and look at the top 10 most frequent 4 word phrases Mary Shelley used in her writing!</p>
<div class="cell">
<div id="tbl-4gram" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: Top 10 4grams from Mary Shelley’s Work</caption>
<thead>
<tr class="header">
<th>4gram</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Project_Gutenberg_Literary_Archive</code></td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td><code>the_Project_Gutenberg_Literary</code></td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td><code>Gutenberg_Literary_Archive_Foundation</code></td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td><code>the_terms_of_this</code></td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td><code>Project_Gutenberg-tm_electronic_works</code></td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td><code>at_the_same_time</code></td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td><code>in_the_United_States</code></td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td><code>to_the_Project_Gutenberg</code></td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td><code>*_*_*_*</code></td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td><code>for_the_sake_of</code></td>
<td style="text-align: right;">21</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>So, either Mary Shelly was obsessed with the <code>Project Gutenberg Literary Archive</code>, and <code>the terms of this</code> and <code>for the sake of</code>, or something else is going on.</p>
<p>As it turns out, every plain text Project Gutenberg book has header information with a short version of the users’ rights and other metadata information, and then at the end has the entirety of the Project Gutenberg License, which is written in legal language.</p>
<p>In any corpus building project, decisions need to be made about how header, footer, and general boilerplate data like this will be treated. There are handy packages for python and R that make stripping out the legal language easy</p>
<ul>
<li>python: <a href="https://github.com/raduangelescu/gutenbergpy"><code>gutenbergpy</code></a></li>
<li>R: <a href="https://docs.ropensci.org/gutenbergr/"><code>gutenbergr</code></a></li>
</ul>
<p>Or, you might decide to leave it all in. It seems pretty clear this is the approach to the dataset they trained GPT-3 on, because if you prompt it with the first few lines of the Project Gutenberg license, it will continue it.</p>
<div id="fig-licenses" class="quarto-layout-panel">
<p></p><figcaption>Figure&nbsp;1: The original Project Gutenberg License vs what GPT3 reproduces</figcaption><p></p>
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/gut_license.png" id="orig-gut" class="img-fluid figure-img" alt="The original plain text Project Gutenberg license"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="assets/gpt3_gut.png" id="gpt_gut" class="img-fluid figure-img" alt="The GPT3 api, which has been given the first few lines of the Project Gutenberg license, and has completed the rest."></p>
</div>
</div>
</figure>
</div>
<section id="markup-is-everywhere" class="level3">
<h3 class="anchored" data-anchor-id="markup-is-everywhere">Markup is everywhere</h3>
<p>Setting aside the issue of headers and footers, we also need to deal with the fact that “markup” is everywhere. Even in the relatively plain text of Project Gutenberg books, they use underscores <code>_</code> to indicate italics or emphasized text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># python</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>underscore_lines <span class="op">=</span> [line </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                      <span class="cf">for</span> line <span class="kw">in</span> book_lines </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">any</span>([<span class="st">"_"</span> <span class="kw">in</span> word </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="cf">for</span> word <span class="kw">in</span> line])]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">" "</span>.join(underscore_lines[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mathilda _is being published
of_ Studies in Philology.
novelette _Mathilda_ together with the opening pages of its rough
draft, _The Fields of Fancy_. They are transcribed from the microfilm</code></pre>
</div>
</div>
<p>This, again, is something we need to decide whether or not we want to include in our corpora. For these massive language models that focus on text generation, they may <em>want</em> the model to generate markup along with the text, so they might leave it in. Some text markup that’s intended to indicate prosodic patterns could be useful to leave in from a linguistic theory perspective.</p>
<p>Either way, though, it is still a <em>decision</em> that needs to be made about the data.</p>
</section>
</section>
<section id="text-normalization" class="level2">
<h2 class="anchored" data-anchor-id="text-normalization">Text Normalization</h2>
<p>I called the issues above “data wrangling”, since it’s mostly about identifying the <em>content</em> we want to be including in our modelling. But once you’ve done that, there are still questions about how we process data for analysis which fall under “text normalization”.</p>
<p>Consider the following sentences</p>
<blockquote class="blockquote">
<p>The 2019 film Cats is a movie about cats. Cats appear in every scene. A cat can always be seen.</p>
</blockquote>
<p>Let’s split this sentence up along whitespace<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and count how many times “cats” appears.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>phrase <span class="op">=</span> <span class="st">"""The 2019 film Cats is a movie about cats. </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">Cats appear in every scene. </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">A cat can always be seen"""</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> re.split(<span class="st">"\s"</span>, phrase)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>cat_c <span class="op">=</span> Counter(words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-cats" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;2: frequency of “cats”</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>word</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cats</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td>cats.</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td>cat</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>A very important thing to keep in mind is that our language models will treat the words in these rows as three completely separate word types.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> That even includes the period <code>.</code> in the second row. Some typical steps involve</p>
<ul>
<li><p>separating punctuation from words</p></li>
<li><p>“case folding” or converting everything to lowercase.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>words2 <span class="op">=</span> re.split(<span class="vs">r"\s"</span>, phrase)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>words2 <span class="op">=</span> [re.sub(<span class="vs">r"\W"</span>, <span class="st">''</span>, word) <span class="cf">for</span> word <span class="kw">in</span> words2]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>words2 <span class="op">=</span> [word.lower() <span class="cf">for</span> word <span class="kw">in</span> words2]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>words2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['the', '2019', 'film', 'cats', 'is', 'a', 'movie', 'about', 'cats', '', 'cats', 'appear', 'in', 'every', 'scene', '', 'a', 'cat', 'can', 'always', 'be', 'seen']</code></pre>
</div>
</div>
<div class="cell">
<div id="tbl-cats_token" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;3: frequency of tokenized “cats”</caption>
<thead>
<tr class="header">
<th>word</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>cats</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td>cat</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We’ve now got a slightly better set of counts. With the punctuation stripped and everything pushed to lowercase, there’s now just two word forms: <code>cats</code> and <code>cat</code>.</p>
<p>One downside, though, is we’ve also collapsed together the title <em>Cats</em>, which refers to either a Broadway musical or a 2019 film, and the word “cats” which refers to furry felines. Merging these two together could be sub-optimal for later tasks, like, say, sentiment analysis of movie reviews.</p>
<blockquote class="blockquote">
<p>‘Cats’ is both a horror and an endurance test, a dispatch from some neon-drenched netherworld where the ghastly is inextricable from the tedious. – <a href="https://www.latimes.com/entertainment-arts/movies/story/2019-12-18/cats-review-andrew-lloyd-webber">LA Times</a></p>
</blockquote>
<details>
<img src="assets/sadcat.jpeg" class="img-fluid" data-fig-align="center" alt="A cat looking at the camera that has been photoshopped to appear as if it is crying.">
</details>
</section>
<section id="tokenization-or-text-is-complex" class="level2">
<h2 class="anchored" data-anchor-id="tokenization-or-text-is-complex">Tokenization (<em>or</em>, text is complex)</h2>
<p>Setting aside <em>semantic</em> issues, there are a lot of things that happen inside of text, especially if it is transcribed speech, that makes normalizing text and <strong>tokenizing</strong> it way more challenging than just splitting up on white space and stripping out punctuation, even just for English.</p>
<section id="places-to-leave-in-punctuation" class="level4">
<h4 class="anchored" data-anchor-id="places-to-leave-in-punctuation">Places to leave in punctuation</h4>
<p>Some examples given by Jurafsky &amp; Martin for where you might want to leave in punctuation are:</p>
<ul>
<li><p>You don’t want to eliminate punctuation from inside <code>Ph.D</code>, or <code>m.p.h.</code>. You also don’t want to eliminate it from some proper names, like ampersands in <code>Procter &amp; Gamble</code>, <code>Texas A&amp;M</code>, <code>A&amp;W</code>, <code>m&amp;m's</code>.</p></li>
<li><p>You’ll want to keep formatting in numerals, and not split them into separate words. These are all possible numeric formats cross culturally for the same quantity</p>
<ul>
<li><p><code>1,000.55</code></p></li>
<li><p><code>1.000,55</code></p></li>
<li><p><code>1 000,55</code></p></li>
</ul></li>
<li><p>Currency symbols should probably be kept together with their numerals, and depending on the culture &amp; denomination.</p>
<ul>
<li><p><code>$0.99</code></p></li>
<li><p><code>99¢</code></p></li>
<li><p><code>€0,99</code></p></li>
</ul></li>
<li><p>Dates: There are so many different permutations on how dates can be formatted that I shouldn’t list them all here, but here are some.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<ul>
<li><p>yyyy-mm-dd <code>2022-09-12</code>, yyyy/mm/dd <code>2022/09/12</code></p></li>
<li><p>yyyy-m-dd <code>2022-9-12</code>, yyyy/m/dd <code>2022/9/12</code></p></li>
<li><p>dd-mm-yyyy <code>12-09-2022</code>, dd/mm/yyyy <code>12/09/2022</code></p></li>
<li><p>dd-m-yyyy <code>12-9-2022</code>, dd/m/yyyy <code>12/9/2022</code></p></li>
<li><p>dd-mm-yy <code>12-09-22</code>, dd/mm/yy <code>12/09/2022</code></p></li>
<li><p>mm-dd-yyyy <code>09-12-2022</code>, mm/dd/yyyy <code>09/12/2022</code></p></li>
<li><p>m-dd-yyyy <code>9-12-2022</code>, m/dd/yyyy <code>9/12/2022</code></p></li>
<li><p>mm-dd-yy <code>09-12-22</code>, mm/dd/yy <code>09/12/22</code></p></li>
<li><p>m-dd-yy <code>9-12-22</code>, m/dd/yy <code>9/12/22</code></p></li>
</ul></li>
<li><p>Emoticons,<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> where the token is entirely punctuation <code>:)</code>, <code>&gt;.&lt;</code>.</p></li>
</ul>
</section>
<section id="places-to-split-up-words" class="level4">
<h4 class="anchored" data-anchor-id="places-to-split-up-words">Places to split up words</h4>
<p>Sometimes the tokens you get back from whitespace tokenization ought to be split up even further. One example might be hyphenated words, like <code>hard-won</code>.</p>
<ul>
<li><code>hard-won</code> ➔ <code>hard</code>, <code>won</code> or <code>hard</code>, <code>-</code>, <code>won</code>.</li>
</ul>
<p>Another example involves clitics, like <code>n't</code> or <code>'re</code> in English.</p>
<ul>
<li><p><code>isn't</code> ➔ <code>is</code>, <code>n't</code></p></li>
<li><p><code>can't</code> ➔ <code>ca</code>, <code>n't</code></p></li>
<li><p><code>what're</code> ➔ <code>what</code>, <code>'re</code></p></li>
</ul>
</section>
<section id="places-to-glue-words-together" class="level4">
<h4 class="anchored" data-anchor-id="places-to-glue-words-together">Places to glue words together</h4>
<p>You might want to also glue together tokens from whitespace tokenization.</p>
<ul>
<li><p><code>New</code>, <code>York</code>, <code>City</code> ➔ <code>New York City</code></p></li>
<li><p><code>Super</code>, <code>Smash</code>, <code>Brothers</code> ➔ <code>Super Smash Brothers</code>.</p></li>
</ul>
</section>
<section id="challenges-with-speech-and-text" class="level4">
<h4 class="anchored" data-anchor-id="challenges-with-speech-and-text">Challenges with speech and text</h4>
<ul>
<li><p><i class="fa-solid fa-keyboard" aria-hidden="true"></i>: $1500</p>
<ul>
<li><p><i class="fa-solid fa-bullhorn" aria-hidden="true"></i>: “one thousand five hundred dollars”</p></li>
<li><p><i class="fa-solid fa-bullhorn" aria-hidden="true"></i>: “fifteen hundred dollars”</p></li>
<li><p><i class="fa-solid fa-bullhorn" aria-hidden="true"></i>: “one and a half thousand dollars”</p></li>
<li><p><i class="fa-solid fa-bullhorn" aria-hidden="true"></i>: “one point five thousand dollars”</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="tokenizers" class="level2">
<h2 class="anchored" data-anchor-id="tokenizers">Tokenizers</h2>
<p>There seem to be <em>broadly</em> two kinds of tokenizers people use, depending on their goals.</p>
<ol type="1">
<li>Tokenizers that try to hew to linguistic structure, and can generate relatively large vocabulary sizes (number of tokens).</li>
<li>Tokenizers that try to keep the vocabulary size <em>relatively</em> small, to make neural network training possible.</li>
</ol>
<section id="wordlanguage-piece-based-tokenizers" class="level3">
<h3 class="anchored" data-anchor-id="wordlanguage-piece-based-tokenizers">Word/language piece based tokenizers</h3>
<p>There are a number of tokenizers available through the nltk (Natural Language Took Kit) <span class="citation" data-cites="bird2009">(<a href="#ref-bird2009" role="doc-biblioref">Bird, Klein, and Loper 2009</a>)</span> python package. They all have slightly different settings and outcomes. Here I’ll compare the PennTreeBank tokenizer, a simpler punctuation-based tokenizer, and a “casual” tokenizer.</p>
<section id="penntreebank" class="level4">
<h4 class="anchored" data-anchor-id="penntreebank">PennTreeBank</h4>
<p>The <a href="https://www.nltk.org/_modules/nltk/tokenize/treebank.html#TreebankWordTokenizer">PennTreeBank tokenizer</a> is built up out of regular expressions (more on that soon). It</p>
<ul>
<li><p>separates out punctuation and non-alphanumeric characters as their own tokens</p></li>
<li><p>Separates off contractions as their own tokens, <a href="https://github.com/nltk/nltk/blob/2e9cf65072f8cecdc5f2beaa7a66ac8de8f5b31e/nltk/tokenize/destructive.py#L18">using a fixed list</a></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> sent_tokenize, TreebankWordTokenizer</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>phrase2 <span class="op">=</span> <span class="st">"""CATS had a budget of $100,000,000, most of which went into the so-called 'digital fur technology'.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">It's a little hard to believe, but it only made $75.5 million at the box office. </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">#badmovie :-P</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sentences <span class="op">=</span> sent_tokenize(phrase2)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> [TreebankWordTokenizer().tokenize(s) <span class="cf">for</span> s <span class="kw">in</span> sentences]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<tbody>
<tr class="odd">
<td><code>CATS</code></td>
<td><code>had</code></td>
<td><code>a</code></td>
<td><code>budget</code></td>
<td><code>of</code></td>
<td><code>$</code></td>
</tr>
<tr class="even">
<td><code>100,000,000</code></td>
<td><code>,</code></td>
<td><code>most</code></td>
<td><code>of</code></td>
<td><code>which</code></td>
<td><code>went</code></td>
</tr>
<tr class="odd">
<td><code>into</code></td>
<td><code>the</code></td>
<td><code>so-called</code></td>
<td><code>'digital</code></td>
<td><code>fur</code></td>
<td><code>technology</code></td>
</tr>
<tr class="even">
<td><code>'</code></td>
<td><code>.</code></td>
<td><code>It</code></td>
<td><code>'s</code></td>
<td><code>a</code></td>
<td><code>little</code></td>
</tr>
<tr class="odd">
<td><code>hard</code></td>
<td><code>to</code></td>
<td><code>believe</code></td>
<td><code>,</code></td>
<td><code>but</code></td>
<td><code>it</code></td>
</tr>
<tr class="even">
<td><code>only</code></td>
<td><code>made</code></td>
<td><code>$</code></td>
<td><code>75.5</code></td>
<td><code>million</code></td>
<td><code>at</code></td>
</tr>
<tr class="odd">
<td><code>the</code></td>
<td><code>box</code></td>
<td><code>office</code></td>
<td><code>.</code></td>
<td><code>#</code></td>
<td><code>badmovie</code></td>
</tr>
<tr class="even">
<td><code>:</code></td>
<td><code>-P</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="simple-whitespace-punctuation-tokenizer" class="level4">
<h4 class="anchored" data-anchor-id="simple-whitespace-punctuation-tokenizer">Simple whitespace + punctuation tokenizer</h4>
<p>Splits strings based on whitespace &amp; non-alphanum</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> wordpunct_tokenize</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> [wordpunct_tokenize(s) <span class="cf">for</span> s <span class="kw">in</span> sentences]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<tbody>
<tr class="odd">
<td><code>CATS</code></td>
<td><code>had</code></td>
<td><code>a</code></td>
<td><code>budget</code></td>
<td><code>of</code></td>
<td><code>$</code></td>
</tr>
<tr class="even">
<td><code>100</code></td>
<td><code>,</code></td>
<td><code>000</code></td>
<td><code>,</code></td>
<td><code>000</code></td>
<td><code>,</code></td>
</tr>
<tr class="odd">
<td><code>most</code></td>
<td><code>of</code></td>
<td><code>which</code></td>
<td><code>went</code></td>
<td><code>into</code></td>
<td><code>the</code></td>
</tr>
<tr class="even">
<td><code>so</code></td>
<td><code>-</code></td>
<td><code>called</code></td>
<td><code>'</code></td>
<td><code>digital</code></td>
<td><code>fur</code></td>
</tr>
<tr class="odd">
<td><code>technology</code></td>
<td><code>'.</code></td>
<td><code>It</code></td>
<td><code>'</code></td>
<td><code>s</code></td>
<td><code>a</code></td>
</tr>
<tr class="even">
<td><code>little</code></td>
<td><code>hard</code></td>
<td><code>to</code></td>
<td><code>believe</code></td>
<td><code>,</code></td>
<td><code>but</code></td>
</tr>
<tr class="odd">
<td><code>it</code></td>
<td><code>only</code></td>
<td><code>made</code></td>
<td><code>$</code></td>
<td><code>75</code></td>
<td><code>.</code></td>
</tr>
<tr class="even">
<td><code>5</code></td>
<td><code>million</code></td>
<td><code>at</code></td>
<td><code>the</code></td>
<td><code>box</code></td>
<td><code>office</code></td>
</tr>
<tr class="odd">
<td><code>.</code></td>
<td><code>#</code></td>
<td><code>badmovie</code></td>
<td><code>:-</code></td>
<td><code>P</code></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="tweet-tokenizer" class="level4">
<h4 class="anchored" data-anchor-id="tweet-tokenizer">Tweet Tokenizer</h4>
<p>Intended to be more apt for <a href="https://github.com/nltk/nltk/blob/develop/nltk/tokenize/casual.py">tokenizing tweets</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> TweetTokenizer</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> [TweetTokenizer().tokenize(s) <span class="cf">for</span> s <span class="kw">in</span> sentences]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<tbody>
<tr class="odd">
<td><code>CATS</code></td>
<td><code>had</code></td>
<td><code>a</code></td>
<td><code>budget</code></td>
<td><code>of</code></td>
<td><code>$</code></td>
</tr>
<tr class="even">
<td><code>100,000</code></td>
<td><code>,</code></td>
<td><code>000</code></td>
<td><code>,</code></td>
<td><code>most</code></td>
<td><code>of</code></td>
</tr>
<tr class="odd">
<td><code>which</code></td>
<td><code>went</code></td>
<td><code>into</code></td>
<td><code>the</code></td>
<td><code>so-called</code></td>
<td><code>'</code></td>
</tr>
<tr class="even">
<td><code>digital</code></td>
<td><code>fur</code></td>
<td><code>technology</code></td>
<td><code>'</code></td>
<td><code>.</code></td>
<td><code>It's</code></td>
</tr>
<tr class="odd">
<td><code>a</code></td>
<td><code>little</code></td>
<td><code>hard</code></td>
<td><code>to</code></td>
<td><code>believe</code></td>
<td><code>,</code></td>
</tr>
<tr class="even">
<td><code>but</code></td>
<td><code>it</code></td>
<td><code>only</code></td>
<td><code>made</code></td>
<td><code>$</code></td>
<td><code>75.5</code></td>
</tr>
<tr class="odd">
<td><code>million</code></td>
<td><code>at</code></td>
<td><code>the</code></td>
<td><code>box</code></td>
<td><code>office</code></td>
<td><code>.</code></td>
</tr>
<tr class="even">
<td><code>#badmovie</code></td>
<td><code>:-P</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="fixed-vocab-tokenizing" class="level3">
<h3 class="anchored" data-anchor-id="fixed-vocab-tokenizing">Fixed Vocab Tokenizing</h3>
<p>The downside of tokenizers like the three above is that you can’t pre-specify how many types you will get out. That is, you can’t pre-specify your vocabulary size. That isn’t ideal for neural-network based models, which need to use matrices of finite and pre-specified size. So there are also tokenizers that keep a fixed cap on the vocabulary size, even if they result in tokens that aren’t really linguistically meaningful.</p>
<section id="byte-pair-encoding" class="level4">
<h4 class="anchored" data-anchor-id="byte-pair-encoding">Byte Pair Encoding</h4>
<p>Byte Pair Encoding is one approach to tokenizing where we can pre-specify the maximum vocabulary size either by setting a maximum vocabulary hyperparameter, or by setting a maximum iteration hyperparameter.</p>
<p>Let’s start out with a fake training of a byte pair encoder with the simple vocabulary “cats can’t canter”. We kick things off treating every character as a token, plus a specialized start-of-word symbol, which I’m representing with <code>_</code>.</p>
<div class="quarto-layout-panel" style="border-style: solid;">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>Tokens</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>_ c a t s
_ c a n ' t
_ c a n t e r</code></pre>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>Types</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{'a', 'e', 't', 'r', 
's', 'n', 'c', "'", '_'}</code></pre>
</div>
</div>
</div>
<div class="cell">

</div>
<p>This is, in principle, the smallest and <em>simplest</em> tokenization we could do for any input text. While the total number of <em>words</em> is infinite, the total number of characters or symbols we use to create those words is finite.</p>
<p>The next step is to count up all of the pairs (or bigrams) of tokens in the training data. In this case, both (<code>_</code>, <code>c</code>) and (<code>c</code>, <code>a</code>) appear equally commonly, so I make a decision and say (<code>_</code>, <code>c</code>) is the one we’ll process first. We’ll paste them together, call them a new type, and replace all (<code>_</code>, <code>c</code>) sequences with <code>_c</code>.</p>
<div class="quarto-layout-panel" style="border-style: solid;">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>tokens</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>_c a t s
_c a n ' t
_c a n t e r</code></pre>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>types</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{'a', 'e', 't', 'r', 
's', 'n', 'c', "'", ' ',
`_c`}</code></pre>
</div>
</div>
</div>
<p>Repeating the process, the most frequently occurring bigram is now (<code>_c</code>, <code>a</code>), so we’ll add <code>_ca</code> as a new type, and replace all (<code>_c</code>, <code>a</code>) sequences with <code>_ca</code>.</p>
<div class="quarto-layout-panel" style="border-style: solid;">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>tokens</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>_ca t s 
_ca n ' t _
_ca n t e r _</code></pre>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>types</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{'a', 'e', 't', 'r', 
's', 'n', 'c', "'", ' ', 
'_c', '_ca'}</code></pre>
</div>
</div>
</div>
<p>Finally, the last most frequent sequence is (<code>_ca</code>, <code>n</code>), so we’ll add <code>_can</code> to the vocabulary, and collapse (<code>_ca</code>, <code>n</code>) sequences.</p>
<div class="quarto-layout-panel" style="border-style: solid;">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>tokens</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>_ca t s
_can ' t
_can t e r</code></pre>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>types</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>{'a', 'e', 't', 'r', 
's', 'n', 'c', "'", ' ', 
'_c', '_ca', '_can'}</code></pre>
</div>
</div>
</div>
<p>We’ll stop at that point, but we could either continue for a fixed number of iterations, or until our type, or vocabulary size reaches a fixed number.</p>
</section>
<section id="training" class="level4">
<h4 class="anchored" data-anchor-id="training">Training</h4>
<p>The python library <code>sentencepiece</code> has a method for training a BPE tokenizer. We’ll run it on <em>Frankenstein</em> with a vocabulary limited to about ~1,000 items to see what we’ll get.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gutenbergpy.textget</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gutenbergpy.gutenbergcache <span class="im">import</span> GutenbergCacheSettings</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sentencepiece <span class="im">as</span> spm</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>GutenbergCacheSettings.<span class="bu">set</span>(TextFilesCacheFolder <span class="op">=</span> <span class="st">"gen/texts/"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>raw_book <span class="op">=</span> gutenbergpy.textget.get_text_by_id(<span class="dv">84</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>clean_book  <span class="op">=</span> gutenbergpy.textget.strip_headers(raw_book)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"gen/texts/frank.txt"</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> <span class="bu">file</span>.write(clean_book)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">file</span>.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>spm.SentencePieceTrainer.train(<span class="bu">input</span> <span class="op">=</span> <span class="st">"gen/texts/frank.txt"</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                               model_prefix <span class="op">=</span> <span class="st">"gen/m"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                               vocab_size <span class="op">=</span> <span class="dv">1000</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                               model_type <span class="op">=</span> <span class="st">"bpe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code above trained the tokenizer and saved it as a model. Here we’ll load it and run it on a sample paragraph to look at the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> spm.SentencePieceProcessor(model_file<span class="op">=</span><span class="st">'gen/m.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>para <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="st">You will rejoice to hear that no disaster has accompanied the</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="st">commencement of an enterprise which you have regarded with such evil</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="st">forebodings. I arrived here yesterday, and my first task is to assure</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="st">my dear sister of my welfare and increasing confidence in the success</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="st">of my undertaking</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sp.encode_as_pieces(para))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['▁You', '▁will', '▁re', 'j', 'o', 'ice', '▁to', '▁he', 'ar', '▁that', '▁no', '▁dis', 'as', 'ter', '▁has', '▁acc', 'om', 'p', 'an', 'ied', '▁the', '▁comm', 'ence', 'ment', '▁of', '▁an', '▁enter', 'pr', 'ise', '▁which', '▁you', '▁have', '▁reg', 'ard', 'ed', '▁with', '▁such', '▁ev', 'il', '▁f', 'ore', 'b', 'od', 'ings', '.', '▁I', '▁arri', 'ved', '▁he', 're', '▁y', 'es', 'ter', 'd', 'ay', ',', '▁and', '▁my', '▁first', '▁t', 'as', 'k', '▁is', '▁to', '▁ass', 'ure', '▁my', '▁dear', '▁s', 'is', 'ter', '▁of', '▁my', '▁we', 'lf', 'are', '▁and', '▁inc', 're', 'as', 'ing', '▁conf', 'id', 'ence', '▁in', '▁the', '▁su', 'cc', 'ess', '▁of', '▁my', '▁under', 't', 'aking']</code></pre>
</div>
</div>
</section>
<section id="the-benefit" class="level4">
<h4 class="anchored" data-anchor-id="the-benefit">The Benefit?</h4>
<p>Why tokenize things this way? On the one hand, we wind up with tokens that don’t align with any particular linguistic structure. On the other, we’ve got a predictable vocabulary size, and a dramatically less serious data sparsity problem.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">method</th>
<th style="text-align: right;">once</th>
<th style="text-align: right;">total</th>
<th style="text-align: right;">proportion once</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bpe</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1015</td>
<td style="text-align: right;">0.009</td>
</tr>
<tr class="even">
<td style="text-align: left;">ptb</td>
<td style="text-align: right;">3533</td>
<td style="text-align: right;">7710</td>
<td style="text-align: right;">0.458</td>
</tr>
</tbody>
</table>
</div>
</div>



</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-bird2009" class="csl-entry" role="doc-biblioentry">
Bird, Steven, Ewan Klein, and Edward Loper. 2009. <em>Natural language processing with Python</em>. Beijing: O’Reilly.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The regex shortcut <code>\s</code> stands for all white space, including spaces, tabs, newlines and character returns.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>At least, before we start doing fancier models that start taking into account distributional semantics.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I’m being tedious here on purpose, because you have to keep in mind that if you wrote a function to handle just one of these possible date formats, it would not immediately translate over to the others!<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This example <em>isn’t</em> from Jurafsky &amp; Martin.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../lectures/data_sparsity/data_sparsity.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data Sparsity</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../lectures/data_processing/addendum.html" class="pagination-link">
        <span class="nav-page-text">Data processing – addendum</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.233">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Josef Fruehwald">
<meta name="dcterms.date" content="2022-10-10">
<meta name="description" content="Ok, here comes some math">

<title>Lin517: Natural Language Processing - ngrams - Perplexity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../lectures/ngram/02_smoothing.html" rel="next">
<link href="../../lectures/ngram/index.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">ngrams - Perplexity</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Lin517: Natural Language Processing</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Resources</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/reading/index.html" class="sidebar-item-text sidebar-link">Reading a technical paper</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/notation/index.html" class="sidebar-item-text sidebar-link">Mathematical notation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lecture Notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Intro</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/what_is_nlp/index.html" class="sidebar-item-text sidebar-link">What is NLP?</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Data Sparsity and Processing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_sparsity/data_sparsity.html" class="sidebar-item-text sidebar-link">Data Sparsity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/index.html" class="sidebar-item-text sidebar-link">Data processing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/addendum.html" class="sidebar-item-text sidebar-link">Data processing – addendum</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lem_stem/index.html" class="sidebar-item-text sidebar-link">Lemmatizing and stemming</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">ngrams</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/index.html" class="sidebar-item-text sidebar-link">ngram Language Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/01-ngram-eval.html" class="sidebar-item-text sidebar-link active">ngrams - Perplexity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/02_smoothing.html" class="sidebar-item-text sidebar-link">ngram - Smoothing</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../lectures/word_vectors/index.html" class="sidebar-item-text sidebar-link">Word Vectors</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/01_concept.html" class="sidebar-item-text sidebar-link">Word Vectors - Concepts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/02_vectors_examples.html" class="sidebar-item-text sidebar-link">Term-Document and Term-Context matrices</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/03_word2vec.html" class="sidebar-item-text sidebar-link">word2vec</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Neural Networks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/gradient_descent/01_gradient_descent.html" class="sidebar-item-text sidebar-link">Gradient Descent</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Models</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/evaluation/index.html" class="sidebar-item-text sidebar-link">Evaluating models</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">python sessions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/00_session1.html" class="sidebar-item-text sidebar-link">Starting Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/01_session2.html" class="sidebar-item-text sidebar-link">Lists and Dictionaries</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/02_session3.html" class="sidebar-item-text sidebar-link">Loops Etc.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/03_session4.html" class="sidebar-item-text sidebar-link">Comprehensions and Useful Things</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/04_session5.html" class="sidebar-item-text sidebar-link">Making and Counting Bigrams</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#evaluating-ngram-models" id="toc-evaluating-ngram-models" class="nav-link active" data-scroll-target="#evaluating-ngram-models">Evaluating NGram Models</a></li>
  <li><a href="#information---in-bits" id="toc-information---in-bits" class="nav-link" data-scroll-target="#information---in-bits">Information - In Bits</a>
  <ul class="collapse">
  <li><a href="#from-bits-to-probability---a-light-switch-analogy" id="toc-from-bits-to-probability---a-light-switch-analogy" class="nav-link" data-scroll-target="#from-bits-to-probability---a-light-switch-analogy">From bits to probability - a light switch analogy</a></li>
  </ul></li>
  <li><a href="#from-probability-to-bits-a.k.a.-surprisal" id="toc-from-probability-to-bits-a.k.a.-surprisal" class="nav-link" data-scroll-target="#from-probability-to-bits-a.k.a.-surprisal">From probability to bits (a.k.a. “surprisal”)</a>
  <ul class="collapse">
  <li><a href="#why-surprisal" id="toc-why-surprisal" class="nav-link" data-scroll-target="#why-surprisal">Why “Surprisal”</a></li>
  </ul></li>
  <li><a href="#expected-surprisal-a.k.a-entropy" id="toc-expected-surprisal-a.k.a-entropy" class="nav-link" data-scroll-target="#expected-surprisal-a.k.a-entropy">Expected Surprisal, (a.k.a <em>Entropy</em>)</a></li>
  <li><a href="#from-bits-back-to-states-a.k.a.-perplexity" id="toc-from-bits-back-to-states-a.k.a.-perplexity" class="nav-link" data-scroll-target="#from-bits-back-to-states-a.k.a.-perplexity">From bits back to states (a.k.a. Perplexity)</a></li>
  <li><a href="#perplexity-of-ngram-models" id="toc-perplexity-of-ngram-models" class="nav-link" data-scroll-target="#perplexity-of-ngram-models">Perplexity of ngram models</a>
  <ul class="collapse">
  <li><a href="#comparing-models" id="toc-comparing-models" class="nav-link" data-scroll-target="#comparing-models">Comparing models</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">ngrams - Perplexity</h1>
  <div class="quarto-categories">
    <div class="quarto-category">ngram</div>
    <div class="quarto-category">models</div>
  </div>
  </div>

<div>
  <div class="description">
    Ok, here comes some math
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Josef Fruehwald </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="evaluating-ngram-models" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-ngram-models">Evaluating NGram Models</h2>
<p>NGram Models are often described in terms of their <strong>perplexity</strong>, which is a technical term from Information Theory. Rather than just dump the formula in here, let’s walk through it, since these information theoretic notions kind of keep coming up.</p>
</section>
<section id="information---in-bits" class="level2">
<h2 class="anchored" data-anchor-id="information---in-bits">Information - In Bits</h2>
<section id="from-bits-to-probability---a-light-switch-analogy" class="level3">
<h3 class="anchored" data-anchor-id="from-bits-to-probability---a-light-switch-analogy">From bits to probability - a light switch analogy</h3>
<section id="one-light-switch" class="level4">
<h4 class="anchored" data-anchor-id="one-light-switch">One light switch</h4>
<p>Let’s say we have a house with one room, and that one room has one light switch, and that light switch could be on <i class="fa-solid fa-toggle-on" aria-hidden="true"></i> or off <i class="fa-solid fa-toggle-off" aria-hidden="true"></i>. Here’s a table of all of the possible lighting states of the house:</p>
<table class="table">
<caption>Lighting configurations, 1 switch</caption>
<thead>
<tr class="header">
<th>Lighting Config</th>
<th style="text-align: center;">Switch 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
</tbody>
</table>
<p>With just 1 switch, we have two possible lighting configurations. If each lighting configuration was equally possible, then the probability of seeing either lighting configuration is 0.5. In information theory terms, our switch is a “bit” (just like the computer bit), and you need 1 bit to represent a 50% probability.</p>
<p><span class="math display">\[
1\text{bit} = 2~\text{states} = \frac{1}{2} \text{probability} = 0.5
\]</span></p>
</section>
<section id="two-light-switches" class="level4">
<h4 class="anchored" data-anchor-id="two-light-switches">Two light switches</h4>
<p>Now, if our house had two rooms, (a living room and a kitchen), and each room had a switch, we can also workout how many different lighting configurations there are for the whole house.</p>
<table class="table">
<caption>Lighting configurations, 2 switches</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>lighting configurations</th>
<th style="text-align: center;">Living Room Switch</th>
<th style="text-align: center;">Kitchen Switch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>living room on, kitchen on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room on, kitchen off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
<tr class="odd">
<td>living room off, kitchen on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room off, kitchen off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
</tbody>
</table>
<p>With 2 switches, we can describe 4 different lighting configurations in the house. And again, if every lighting configuration was equally likely, that means there is a <span class="math inline">\(\frac{1}{4}=0.25\)</span> probability we are describing with these two bits.</p>
<p><span class="math display">\[
2\text{bits} = 4~\text{states}=\frac{1}{4}=0.25
\]</span></p>
</section>
<section id="three-light-switches" class="level4">
<h4 class="anchored" data-anchor-id="three-light-switches">Three Light switches</h4>
<p>Let’s add 1 more room to the house (and then we’ll stop) that also has a switch. Here’s the table of house lighting configurations.</p>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>lighting configuration</th>
<th style="text-align: center;">Living Room Switch</th>
<th style="text-align: center;">Kitchen Switch</th>
<th style="text-align: center;">Bedroom Switch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>living room on, kitchen on, bedroom on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room on, kitchen on, bedroom off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
<tr class="odd">
<td>living room on, kitchen off, bedroom on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room on, kitchen off, bedroom off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
<tr class="odd">
<td>living room off, kitchen on, bedroom on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room off, kitchen on, bedroom off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
<tr class="odd">
<td>living room off, kitchen off, bedroom on</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-on" aria-hidden="true"></i></p></td>
</tr>
<tr class="even">
<td>living room off, kitchen off, bedroom off</td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
<td style="text-align: center;"><p><i class="fa-solid fa-toggle-off" aria-hidden="true"></i></p></td>
</tr>
</tbody>
</table>
<p>With 3 switches, we can describe 8 different house light configurations</p>
<p><span class="math display">\[
3\text{bits} = 8~\text{states} = \frac{1}{8} = 0.125
\]</span></p>
</section>
<section id="n-light-switches" class="level4">
<h4 class="anchored" data-anchor-id="n-light-switches">N Light switches</h4>
<p>There is a <em>general</em> formula for figuring out how many states can be described by N bits, and therefore the probability of events they can represent.</p>
<p><span class="math display">\[
N~\text{bits} = 2^N ~\text{states} = \frac{1}{2^N}~\text{probability}
\]</span></p>
<p>The number 2 got in there because that’s how many different options there are for each switch (on <i class="fa-solid fa-toggle-on" aria-hidden="true"></i> or off <i class="fa-solid fa-toggle-off" aria-hidden="true"></i>).</p>
</section>
</section>
</section>
<section id="from-probability-to-bits-a.k.a.-surprisal" class="level2">
<h2 class="anchored" data-anchor-id="from-probability-to-bits-a.k.a.-surprisal">From probability to bits (a.k.a. “surprisal”)</h2>
<p>Ok, what if we didn’t know how many bits, or switches we had, but we knew the <em>probability</em> of something, and we want to know how many bits we need to represent that probability. For example, maybe we estimated the unigram probability of “the” in the novel Frankenstein.</p>
<div class="cell">

</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>frank <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"the"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  word      n   prob
  &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt;
1 the    4194 0.0558</code></pre>
</div>
</div>
<p>We’re in a classic math word problem: Solve for N</p>
<p><span class="math display">\[
0.056 = \frac{1}{2^N}
\]</span></p>
<p>I’ve put the math steps to work this out in the collapsed Details block below, but to get N here, we need to take the negative <span class="math inline">\(\log_2\)</span> of the probability</p>
<details>
<p><span class="math display">\[
\frac{1}{2^N} = 2^{-N}
\]</span></p>
<p><span class="math display">\[
\log_2(2^{-N}) = -N
\]</span></p>
<p><span class="math display">\[
-\log_2(2^{-N}) = N
\]</span></p>
</details>
<p><span class="math display">\[
N = -\log_2(0.056) = 4.16
\]</span></p>
<p>We’ve obviously moved away from the concrete analogy of light switches, since it’s impossible to have 4 and 0.16 switches in your house. But this <em>is</em> a measure of how much <em>information</em> the probability takes up. It’s also often called <strong>surprisal</strong> as a technical term.</p>
<section id="why-surprisal" class="level3">
<h3 class="anchored" data-anchor-id="why-surprisal">Why “Surprisal”</h3>
<p>Imagine I came up to you and said:</p>
<blockquote class="blockquote">
<p>The sun rose this morning.</p>
</blockquote>
<p>That’s not especially <em>informative</em> or <em>surprising</em>, since the sun rises every morning. The sun rising in the morning is a very high probability event,<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> so it’s not surprising it happens, and in the information theory world, we don’t need very many bits for it.</p>
<p>On the other hand, if someone came up to me and said:</p>
<blockquote class="blockquote">
<p>The sun failed to rise this morning.</p>
</blockquote>
<p><em>That</em> is surprising! It’s also very informative. Thank you for telling me! I wasn’t expecting that! The smaller the probability of an event, the more surprising and informative it is if it happens, the larger the <em>surprisal</em> value is.</p>
<p>Here’s a plot showing the relationship between the unigram probability of a word in <em>Frankenstein</em>, and its surprisal in <em>bits</em>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01-ngram-eval_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="expected-surprisal-a.k.a-entropy" class="level2">
<h2 class="anchored" data-anchor-id="expected-surprisal-a.k.a-entropy">Expected Surprisal, (a.k.a <em>Entropy</em>)</h2>
<p>So, we can calculate the probability of individual words in a book like <em>Frankenstein</em>, and from that probability, we can calculate each word’s surprisal.</p>
<p>The next thing to ask is what is the <em>expected surprisal</em> in a book like Frankenstein? As we’re reading the book, very common words will happen very often, and less common words will happen less often. What is our <em>overall</em> experience of reading the book like, in terms of surprisal? Here’s a table of some words that have a wide range of frequencies in the book.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>frank <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(n),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">surprisal =</span> <span class="sc">-</span><span class="fu">log2</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"the"</span>, <span class="st">"monster"</span>, <span class="st">"snow"</span>, <span class="st">"russia"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  word        n total      prob surprisal
  &lt;chr&gt;   &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 the      4194 75143 0.0558         4.16
2 monster    31 75143 0.000413      11.2 
3 snow       16 75143 0.000213      12.2 
4 russia      2 75143 0.0000266     15.2 </code></pre>
</div>
</div>
<p>We could try just taking the average of the <code>surprisal</code> column to get the “average surprisal”, but that’s not quite right in terms of capturing the expected surprisal. Yes, words like <code>snow</code> and <code>russia</code> have a large surprisals, so they should drag our estimate upwards, but they don’t, by definition, happen all that often, so they shouldn’t drag it up <em>too</em> much.</p>
<p>What we do instead is multiply the surprisal value of each word by its probability, and sum it up! This will capture our experience of <code>the</code> having a small surprisal and happening often, and words like <code>snow</code> having a large surprisal, but happening less often.</p>
<p>This “expected surprisal” is called <em>entropy</em>, and is often represented by <span class="math inline">\(H(X)\)</span></p>
<p><span class="math display">\[
\begin{array}{ll}
\text{surprisal:} &amp; {s(x_i)=-\log_2(p(x_i))}\\
\text{entropy:} &amp; H(X) = \sum_{i=1}^np(x_i)s(x_i)
\end{array}
\]</span></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>frank <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">surprisal =</span> <span class="sc">-</span><span class="fu">log2</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">entropy =</span> <span class="fu">sum</span>(prob <span class="sc">*</span> surprisal))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  entropy
    &lt;dbl&gt;
1    9.30</code></pre>
</div>
</div>
<p>So, on average, while reading <em>Frankenstein</em>, (and only paying attention to unigram distribution), we have an expected surprisal (a.k.a, entropy) of <span class="math inline">\(\approx\)</span> 9.3 bits.</p>
</section>
<section id="from-bits-back-to-states-a.k.a.-perplexity" class="level2">
<h2 class="anchored" data-anchor-id="from-bits-back-to-states-a.k.a.-perplexity">From bits back to states (a.k.a. Perplexity)</h2>
<p>Now there are just over 7,000 unique word types in Frankenstein.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>frank <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7020</code></pre>
</div>
</div>
<p>But because not every word is <em>equally</em> likely to show up, the expected surprisal, or entropy of the book is 9.3 bits. Just above, we saw that we can calculate the number of unique states we can encode with N bits with this formula:</p>
<p><span class="math display">\[
N~\text{bits} = 2^N~\text{states}
\]</span></p>
<p>If we do this with the entropy value we got in bits, that would be</p>
<p><span class="math display">\[
H(\text{Frankenstein}) \approx 9.3~\text{bits}
\]</span></p>
<p><span class="math display">\[
9.3\text{bits} = 2^{9.3}~\text{states} \approx 630~\text{states}
\]</span>This is the estimated “perplexity” of the unigram model. Here’s how to think about it. If we already know the probability of every word that appears in the book, and we use that probability distribution to guess each next word in the book, it’s going to be as successful as trying to guess which next state is coming up out of 630 equally probable states.</p>
</section>
<section id="perplexity-of-ngram-models" class="level2">
<h2 class="anchored" data-anchor-id="perplexity-of-ngram-models">Perplexity of ngram models</h2>
<p>In the first lecture on ngram models, we built a boring bigram model that looked like this.</p>
<div class="cell" data-fig-responsive="true" data-file="figure/5sent.dot" data-fig-caption="A bigram model">
<div class="cell-output-display">
<div>
<p>
<svg width="672" height="480" viewbox="0.00 0.00 648.01 124.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 120)"> <polygon fill="white" stroke="transparent" points="-4,4 -4,-120 644.01,-120 644.01,4 -4,4"></polygon> <!-- a --> <g id="node1" class="node">
<title>
a
</title>
<ellipse fill="none" stroke="black" cx="394.05" cy="-85" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="394.05" y="-80.8" font-family="Times,serif" font-size="14.00">a</text> </g> <!-- book --> <g id="node2" class="node">
<title>
book
</title>
<ellipse fill="none" stroke="black" cx="504.9" cy="-98" rx="30.2" ry="18"></ellipse> <text text-anchor="middle" x="504.9" y="-93.8" font-family="Times,serif" font-size="14.00">book</text> </g> <!-- a&#45;&gt;book --> <g id="edge1" class="edge">
<title>
a-&gt;book
</title>
<path fill="none" stroke="black" stroke-width="3" d="M420.84,-88.08C433.89,-89.64 450.02,-91.57 464.57,-93.3"></path> <polygon fill="black" stroke="black" stroke-width="3" points="464.49,-96.82 474.83,-94.53 465.32,-89.87 464.49,-96.82"></polygon> <text text-anchor="middle" x="447.8" y="-96.2" font-family="Times,serif" font-size="14.00">0.5</text> </g> <!-- dog --> <g id="node3" class="node">
<title>
dog
</title>
<ellipse fill="none" stroke="black" cx="504.9" cy="-44" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="504.9" y="-39.8" font-family="Times,serif" font-size="14.00">dog</text> </g> <!-- a&#45;&gt;dog --> <g id="edge2" class="edge">
<title>
a-&gt;dog
</title>
<path fill="none" stroke="black" stroke-width="3" d="M417.87,-76.41C433.39,-70.56 454.18,-62.73 471.43,-56.23"></path> <polygon fill="black" stroke="black" stroke-width="3" points="472.98,-59.38 481.11,-52.58 470.52,-52.83 472.98,-59.38"></polygon> <text text-anchor="middle" x="447.8" y="-72.2" font-family="Times,serif" font-size="14.00">0.5</text> </g> <!-- END --> <g id="node4" class="node">
<title>
END
</title>
<ellipse fill="none" stroke="black" cx="609.13" cy="-71" rx="30.77" ry="18"></ellipse> <text text-anchor="middle" x="609.13" y="-66.8" font-family="Times,serif" font-size="14.00">END</text> </g> <!-- book&#45;&gt;END --> <g id="edge3" class="edge">
<title>
book-&gt;END
</title>
<path fill="none" stroke="black" stroke-width="6" d="M533.03,-90.84C544.6,-87.78 558.3,-84.16 570.81,-80.86"></path> <polygon fill="black" stroke="black" stroke-width="6" points="572.19,-85.92 580.52,-78.29 569.51,-75.77 572.19,-85.92"></polygon> <text text-anchor="middle" x="556.75" y="-89.2" font-family="Times,serif" font-size="14.00">1</text> </g> <!-- dog&#45;&gt;END --> <g id="edge4" class="edge">
<title>
dog-&gt;END
</title>
<path fill="none" stroke="black" stroke-width="6" d="M530.38,-50.47C542.44,-53.65 557.23,-57.56 570.66,-61.1"></path> <polygon fill="black" stroke="black" stroke-width="6" points="569.59,-66.25 580.6,-63.73 572.27,-56.1 569.59,-66.25"></polygon> <text text-anchor="middle" x="556.75" y="-62.2" font-family="Times,serif" font-size="14.00">1</text> </g> <!-- I --> <g id="node5" class="node">
<title>
I
</title>
<ellipse fill="none" stroke="black" cx="163.74" cy="-72" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="163.74" y="-67.8" font-family="Times,serif" font-size="14.00">I</text> </g> <!-- read --> <g id="node6" class="node">
<title>
read
</title>
<ellipse fill="none" stroke="black" cx="278.89" cy="-98" rx="27.81" ry="18"></ellipse> <text text-anchor="middle" x="278.89" y="-93.8" font-family="Times,serif" font-size="14.00">read</text> </g> <!-- I&#45;&gt;read --> <g id="edge5" class="edge">
<title>
I-&gt;read
</title>
<path fill="none" stroke="black" stroke-width="1.5" d="M189.57,-77.71C204.98,-81.25 225.03,-85.85 242.14,-89.78"></path> <polygon fill="black" stroke="black" stroke-width="1.5" points="241.81,-93.3 252.34,-92.13 243.37,-86.48 241.81,-93.3"></polygon> <text text-anchor="middle" x="220.99" y="-91.2" font-family="Times,serif" font-size="14.00">0.25</text> </g> <!-- saw --> <g id="node7" class="node">
<title>
saw
</title>
<ellipse fill="none" stroke="black" cx="278.89" cy="-31" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="278.89" y="-26.8" font-family="Times,serif" font-size="14.00">saw</text> </g> <!-- I&#45;&gt;saw --> <g id="edge6" class="edge">
<title>
I-&gt;saw
</title>
<path fill="none" stroke="black" stroke-width="4.5" d="M187.91,-63.6C204.46,-57.61 226.96,-49.46 245.31,-42.8"></path> <polygon fill="black" stroke="black" stroke-width="4.5" points="246.69,-46.49 254.75,-39.38 244.01,-39.09 246.69,-46.49"></polygon> <text text-anchor="middle" x="220.99" y="-60.2" font-family="Times,serif" font-size="14.00">0.75</text> </g> <!-- read&#45;&gt;a --> <g id="edge7" class="edge">
<title>
read-&gt;a
</title>
<path fill="none" stroke="black" stroke-width="6" d="M306.42,-94.95C321.43,-93.23 340.4,-91.05 356.77,-89.17"></path> <polygon fill="black" stroke="black" stroke-width="6" points="357.74,-94.34 367.07,-87.98 356.54,-83.91 357.74,-94.34"></polygon> <text text-anchor="middle" x="336.8" y="-96.2" font-family="Times,serif" font-size="14.00">1</text> </g> <!-- saw&#45;&gt;a --> <g id="edge8" class="edge">
<title>
saw-&gt;a
</title>
<path fill="none" stroke="black" stroke-width="4.5" d="M301.44,-41.28C318.67,-49.5 343.03,-61.13 362.3,-70.33"></path> <polygon fill="black" stroke="black" stroke-width="4.5" points="360.86,-74 371.58,-74.75 364.25,-66.89 360.86,-74"></polygon> <text text-anchor="middle" x="336.8" y="-66.2" font-family="Times,serif" font-size="14.00">0.75</text> </g> <!-- the --> <g id="node8" class="node">
<title>
the
</title>
<ellipse fill="none" stroke="black" cx="394.05" cy="-18" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="394.05" y="-13.8" font-family="Times,serif" font-size="14.00">the</text> </g> <!-- saw&#45;&gt;the --> <g id="edge9" class="edge">
<title>
saw-&gt;the
</title>
<path fill="none" stroke="black" stroke-width="1.5" d="M303.78,-23.55C310.44,-21.79 317.72,-20.15 324.55,-19.2 334.97,-17.75 346.38,-17.16 356.84,-17.01"></path> <polygon fill="black" stroke="black" stroke-width="1.5" points="356.92,-20.51 366.91,-16.99 356.9,-13.51 356.92,-20.51"></polygon> <text text-anchor="middle" x="336.8" y="-24.2" font-family="Times,serif" font-size="14.00">0.25</text> </g> <!-- the&#45;&gt;dog --> <g id="edge12" class="edge">
<title>
the-&gt;dog
</title>
<path fill="none" stroke="black" stroke-width="6" d="M421.14,-15.88C432.21,-15.65 445.17,-16.28 456.55,-19.2 463.04,-20.86 469.63,-23.56 475.75,-26.58"></path> <polygon fill="black" stroke="black" stroke-width="6" points="473.61,-31.39 484.91,-31.48 478.57,-22.13 473.61,-31.39"></polygon> <text text-anchor="middle" x="447.8" y="-24.2" font-family="Times,serif" font-size="14.00">1</text> </g> <!-- START --> <g id="node9" class="node">
<title>
START
</title>
<ellipse fill="none" stroke="black" cx="41.62" cy="-45" rx="41.74" ry="18"></ellipse> <text text-anchor="middle" x="41.62" y="-40.8" font-family="Times,serif" font-size="14.00">START</text> </g> <!-- START&#45;&gt;I --> <g id="edge10" class="edge">
<title>
START-&gt;I
</title>
<path fill="none" stroke="black" stroke-width="4.8" d="M78.99,-53.17C94.47,-56.65 112.46,-60.7 127.79,-64.14"></path> <polygon fill="black" stroke="black" stroke-width="4.8" points="127.23,-68.32 137.91,-66.42 129.07,-60.13 127.23,-68.32"></polygon> <text text-anchor="middle" x="109.99" y="-65.2" font-family="Times,serif" font-size="14.00">0.8</text> </g> <!-- We --> <g id="node10" class="node">
<title>
We
</title>
<ellipse fill="none" stroke="black" cx="163.74" cy="-18" rx="27" ry="18"></ellipse> <text text-anchor="middle" x="163.74" y="-13.8" font-family="Times,serif" font-size="14.00">We</text> </g> <!-- START&#45;&gt;We --> <g id="edge11" class="edge">
<title>
START-&gt;We
</title>
<path fill="none" stroke="black" stroke-width="1.2" d="M78.99,-36.83C94.47,-33.35 112.46,-29.3 127.79,-25.86"></path> <polygon fill="black" stroke="black" stroke-width="1.2" points="128.92,-29.19 137.91,-23.58 127.38,-22.36 128.92,-29.19"></polygon> <text text-anchor="middle" x="109.99" y="-36.2" font-family="Times,serif" font-size="14.00">0.2</text> </g> <!-- We&#45;&gt;saw --> <g id="edge13" class="edge">
<title>
We-&gt;saw
</title>
<path fill="none" stroke="black" stroke-width="6" d="M190.88,-16.99C203.7,-16.86 219.34,-17.27 233.24,-19.2 236.76,-19.69 240.4,-20.36 244.02,-21.14"></path> <polygon fill="black" stroke="black" stroke-width="6" points="243.06,-26.31 254.01,-23.55 245.52,-16.1 243.06,-26.31"></polygon> <text text-anchor="middle" x="220.99" y="-24.2" font-family="Times,serif" font-size="14.00">1</text> </g> </g>
</svg>
</p>
</div>
</div>
</div>
<p>And, we worked out that we could estimate the probability a new sentence like this:</p>
<style>
    .bigrampath{
    }
    .bg1{
      color: #440154; 
    }
    .bg2{
      color: #3b528b; 
    }
    .bg3{
      color: #21918c;
    }
    .bg4{
      color: #5ec962;
    }
    .bg5{
      color: #fde725;
    }
    .bigrampath tr:nth-child(7) td:nth-child(10){background : #440154; color: white;}
    .bigrampath tr:nth-child(9) td:nth-child(8) {background : #3b528b; color: white;}
    .bigrampath tr:nth-child(6) td:nth-child(9) {background : #21918c; color: white;}
    .bigrampath tr:nth-child(8) td:nth-child(4) {background : #5ec962; }
    .bigrampath tr:nth-child(3) td:nth-child(5) {background : #fde725; }
</style>
<p><span class="bg1">P(We | &lt;START&gt;)</span> <span class="math inline">\(\times\)</span> <span class="bg2">P(saw | We)</span> <span class="math inline">\(\times\)</span> <span class="bg3">P(the | saw)</span> <span class="math inline">\(\times\)</span> <span class="bg4">P(dog | saw)</span> <span class="math inline">\(\times\)</span> <span class="bg5">P(&lt;END&gt; | dog)</span></p>
<div class="bigrampath">
<div class="cell-output-display">
<table class="table">
<colgroup>
<col style="width: 1%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">words</th>
<th style="text-align: left;">a</th>
<th style="text-align: left;">book</th>
<th style="text-align: left;">dog</th>
<th style="text-align: left;">END</th>
<th style="text-align: left;">I</th>
<th style="text-align: left;">read</th>
<th style="text-align: left;">saw</th>
<th style="text-align: left;">the</th>
<th style="text-align: left;">We</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">0.5</td>
<td style="text-align: left;">0.5</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">book</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">dog</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">I</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;">0.75</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">read</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">saw</td>
<td style="text-align: left;">0.75</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">0.25</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">START</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">0.8</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">the</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">We</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
<td style="text-align: left;"><span style="color:grey">0</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<p><span class="math display">\[
P(X) = 0.2 \times 1 \times 1\times 0.25 \times 1 = 0.05
\]</span></p>
<p>With this probability, we can figure out how many total bits we need to encode this probability (a.k.a. the surprisal)</p>
<p><span class="math display">\[
s(X) = -\log_2(p(X)) = -\log_2(0.05) = 4.32
\]</span></p>
<p>Now, where evaluating ngram models diverge a bit from what we were doing before is we now figure out what the surprisial is <em>per word</em>, so we get bits per word (including the sentence ending tag).</p>
<p><span class="math display">\[
spw(X)=\frac{-\log_2(p(X))}{N} = \frac{-\log_2(0.05)}{5} =0.86
\]</span> To get the <em>perplexity</em> of this sentence, given the bigram model, we follow the formula for getting the number of states given a number of bits.</p>
<p><span class="math display">\[
pp(X) = 2^{spw(X)} = 2^{0.86} = 1.82
\]</span></p>
<section id="comparing-models" class="level3">
<h3 class="anchored" data-anchor-id="comparing-models">Comparing models</h3>
<p>If model A assigns higher probabilities to the sentences in a test set than model B, then model A will have a smaller perplexity.</p>
<p>Another way to think about the perplexity if ngram models, as Jurafsky &amp; Martin point out, is that it’s the “weighted average branching factor”. Looking back at the bigram diagram above, it’s like saying “Any time you are at a node, you are, on average, choosing between 1.82 possible branches to go down.”</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Depending on what latitude you live at and the time of year.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>…with the tokenizer I used anyway.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../lectures/ngram/index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">ngram Language Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../lectures/ngram/02_smoothing.html" class="pagination-link">
        <span class="nav-page-text">ngram - Smoothing</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
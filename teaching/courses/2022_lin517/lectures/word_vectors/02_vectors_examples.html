<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.233">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Josef Fruehwald">
<meta name="dcterms.date" content="2022-11-01">

<title>Lin517: Natural Language Processing - Term-Document and Term-Context matrices</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../lectures/word_vectors/03_word2vec.html" rel="next">
<link href="../../lectures/word_vectors/01_concept.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Term-Document and Term-Context matrices</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Lin517: Natural Language Processing</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Resources</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/reading/index.html" class="sidebar-item-text sidebar-link">Reading a technical paper</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../resources/notation/index.html" class="sidebar-item-text sidebar-link">Mathematical notation</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lecture Notes</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Intro</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/what_is_nlp/index.html" class="sidebar-item-text sidebar-link">What is NLP?</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Data Sparsity and Processing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_sparsity/data_sparsity.html" class="sidebar-item-text sidebar-link">Data Sparsity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/index.html" class="sidebar-item-text sidebar-link">Data processing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/data_processing/addendum.html" class="sidebar-item-text sidebar-link">Data processing – addendum</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lem_stem/index.html" class="sidebar-item-text sidebar-link">Lemmatizing and stemming</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">ngrams</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/index.html" class="sidebar-item-text sidebar-link">ngram Language Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/01-ngram-eval.html" class="sidebar-item-text sidebar-link">ngrams - Perplexity</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/ngram/02_smoothing.html" class="sidebar-item-text sidebar-link">ngram - Smoothing</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../lectures/word_vectors/index.html" class="sidebar-item-text sidebar-link">Word Vectors</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/01_concept.html" class="sidebar-item-text sidebar-link">Word Vectors - Concepts</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/02_vectors_examples.html" class="sidebar-item-text sidebar-link active">Term-Document and Term-Context matrices</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/word_vectors/03_word2vec.html" class="sidebar-item-text sidebar-link">word2vec</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Neural Networks</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/gradient_descent/01_gradient_descent.html" class="sidebar-item-text sidebar-link">Gradient Descent</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">Models</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/evaluation/index.html" class="sidebar-item-text sidebar-link">Evaluating models</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">python sessions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/00_session1.html" class="sidebar-item-text sidebar-link">Starting Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/01_session2.html" class="sidebar-item-text sidebar-link">Lists and Dictionaries</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/02_session3.html" class="sidebar-item-text sidebar-link">Loops Etc.</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/03_session4.html" class="sidebar-item-text sidebar-link">Comprehensions and Useful Things</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../python_sessions/04_session5.html" class="sidebar-item-text sidebar-link">Making and Counting Bigrams</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a></li>
  <li><a href="#term-document-matrices" id="toc-term-document-matrices" class="nav-link" data-scroll-target="#term-document-matrices">Term-Document Matrices</a>
  <ul class="collapse">
  <li><a href="#getting-the-whole-term-document-matrix-python-time" id="toc-getting-the-whole-term-document-matrix-python-time" class="nav-link" data-scroll-target="#getting-the-whole-term-document-matrix-python-time">Getting the whole term-document matrix: python time</a></li>
  <li><a href="#whats-an-important-word-for-each-document-tfidf" id="toc-whats-an-important-word-for-each-document-tfidf" class="nav-link" data-scroll-target="#whats-an-important-word-for-each-document-tfidf">What’s an important word <em>for</em> each document (tf–idf)?</a></li>
  </ul></li>
  <li><a href="#term-context-matrix" id="toc-term-context-matrix" class="nav-link" data-scroll-target="#term-context-matrix">Term-context matrix</a>
  <ul class="collapse">
  <li><a href="#a-quick-and-dirty-term-context-matrix" id="toc-a-quick-and-dirty-term-context-matrix" class="nav-link" data-scroll-target="#a-quick-and-dirty-term-context-matrix">A quick and dirty term-context matrix</a></li>
  <li><a href="#positive-pointwise-mutual-information" id="toc-positive-pointwise-mutual-information" class="nav-link" data-scroll-target="#positive-pointwise-mutual-information">Positive Pointwise Mutual Information</a></li>
  </ul></li>
  <li><a href="#doing-it-not-by-hand" id="toc-doing-it-not-by-hand" class="nav-link" data-scroll-target="#doing-it-not-by-hand">Doing it not “by hand”</a>
  <ul class="collapse">
  <li><a href="#tf-idf" id="toc-tf-idf" class="nav-link" data-scroll-target="#tf-idf">Tf-idf</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Term-Document and Term-Context matrices</h1>
  <div class="quarto-categories">
    <div class="quarto-category">word vectors</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Josef Fruehwald </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 1, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
</section>
<section id="term-document-matrices" class="level2">
<h2 class="anchored" data-anchor-id="term-document-matrices">Term-Document Matrices</h2>
<p>Last time, we started looking at limited view of Term-Document matrices. Here we’ve got books in the rows, and the words <code>monster</code> and <code>sea</code> as the dimensions of the vector space.</p>
<div class="cell tbl-cap-location-bottom">
<details>
<summary>Code to download and process books from Project Gutenberg.</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gutenbergpy.textget</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> RegexpTokenizer</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os.path <span class="im">import</span> exists</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getbook(book, outfile):</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">  Download a book from project Gutenberg and save it </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">  to the specified outfile</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> exists(outfile):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Downloading Project Gutenberg ID </span><span class="sc">{</span>book<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    raw_book <span class="op">=</span> gutenbergpy.textget.get_text_by_id(book)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    clean_book <span class="op">=</span> gutenbergpy.textget.strip_headers(raw_book)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> outfile:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      outfile <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>book<span class="sc">}</span><span class="ss">.txt'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f"Saving book as </span><span class="sc">{</span>outfile<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(outfile, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="bu">file</span>.write(clean_book)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="bu">file</span>.close()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_unigram_counts(path):</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">    Given a path, generate a counter dictionary of unigrams</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> f.read()</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> text.replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>).lower()</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  unigrams <span class="op">=</span> RegexpTokenizer(<span class="vs">r"\w+"</span>).tokenize(text)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  count <span class="op">=</span> Counter(unigrams)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(count)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_term_count(book_dict, term):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">    return a list of the number of times a term has appeared</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">    in a book</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  out <span class="op">=</span> [book_dict[book][term] <span class="cf">for</span> book <span class="kw">in</span> book_dict]</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(out)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>mary_shelley_ids <span class="op">=</span> [<span class="dv">84</span>, <span class="dv">15238</span>, <span class="dv">18247</span>, <span class="dv">64329</span>]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>mary_shelley_files <span class="op">=</span>  [<span class="ss">f"gen/books/shelley/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span> <span class="cf">for</span> x <span class="kw">in</span> mary_shelley_ids]</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>mary_shelley_titles <span class="op">=</span> [<span class="st">"Frankenstein"</span>, <span class="st">"Mathilda"</span>, <span class="st">"The Last Man"</span>, <span class="st">"Falkner"</span>]</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>jules_verne_ids <span class="op">=</span> [<span class="dv">103</span>, <span class="dv">164</span>, <span class="dv">1268</span>, <span class="dv">18857</span>]</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>jules_verne_files <span class="op">=</span> [<span class="ss">f"gen/books/verne/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span> <span class="cf">for</span> x <span class="kw">in</span> jules_verne_ids]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>jules_verne_titles <span class="op">=</span> [<span class="st">"80days"</span>, <span class="st">"ThousandLeagues"</span>, <span class="st">"MysteriousIsland"</span>, <span class="st">"CenterOfTheEarth"</span>]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>foo <span class="op">=</span> [getbook(x, <span class="ss">f"gen/books/shelley/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span>) <span class="cf">for</span> x <span class="kw">in</span> mary_shelley_ids]</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>foo <span class="op">=</span> [getbook(x, <span class="ss">f"gen/books/verne/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span>) <span class="cf">for</span> x <span class="kw">in</span> jules_verne_ids]</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>shelley_words <span class="op">=</span> {k:get_unigram_counts(v) </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(mary_shelley_titles, mary_shelley_files)}</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>verne_words <span class="op">=</span> {k:get_unigram_counts(v) </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(jules_verne_titles, jules_verne_files)}</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>monster <span class="op">=</span> [<span class="st">"monster"</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>          get_term_count(shelley_words, <span class="st">"monster"</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>          get_term_count(verne_words, <span class="st">"monster"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>sea  <span class="op">=</span> [<span class="st">"sea"</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>          get_term_count(shelley_words, <span class="st">"sea"</span>) <span class="op">+</span> <span class="op">\</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>          get_term_count(verne_words, <span class="st">"sea"</span>)                 </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>transpose <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(mary_shelley_titles<span class="op">+</span>jules_verne_titles, monster[<span class="dv">1</span>:], sea[<span class="dv">1</span>:]))</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(transpose, headers<span class="op">=</span>[<span class="st">"book"</span>, <span class="st">"monster"</span>, <span class="st">"sea"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-monster-sea" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: Books by Mary Shelley and Jules Verne in the ‘monster’, ‘sea’ vector space.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">book</th>
<th style="text-align: right;">monster</th>
<th style="text-align: right;">sea</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Frankenstein</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">34</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mathilda</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">The Last Man</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">118</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falkner</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80days</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">ThousandLeagues</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">357</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MysteriousIsland</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">277</td>
</tr>
<tr class="even">
<td style="text-align: left;">CenterOfTheEarth</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">122</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>I call this a “limited” term-document matrix, since we’re only looking at the frequency of two hand-picked word dimensions. If we’d chosen some other words to serve as the dimensions, some of them will have very high counts, and others will be mostly 0. For example, <code>the</code> appears very frequently in all books, and <code>illustration</code> doesn’t appear at all in most of the books.</p>
<div class="cell tbl-cap-location-margin">
<details>
<summary>Code to generate the ‘the’, ‘illustration’ table.</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>the <span class="op">=</span>  [verne_words[book][<span class="st">"the"</span>] <span class="cf">for</span> book <span class="kw">in</span> verne_words] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                [shelley_words[book][<span class="st">"the"</span>] <span class="cf">for</span> book <span class="kw">in</span> shelley_words]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>illustration <span class="op">=</span> [verne_words[book][<span class="st">"illustration"</span>] <span class="cf">for</span> book <span class="kw">in</span> verne_words] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                [shelley_words[book][<span class="st">"illustration"</span>] <span class="cf">for</span> book <span class="kw">in</span> shelley_words]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> [book <span class="cf">for</span> book <span class="kw">in</span> verne_words] <span class="op">+</span> [book <span class="cf">for</span> book <span class="kw">in</span> shelley_words]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  tabulate(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>(<span class="bu">zip</span>(titles, the, illustration)), </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    headers<span class="op">=</span>[<span class="st">"book"</span>, <span class="st">"the"</span>, <span class="st">"illustration"</span>],</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    intfmt<span class="op">=</span><span class="st">","</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-the-illustration" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;2: Books by Mary Shelley and Jules Verne in the ‘the’, ‘illustration’ vector space.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">book</th>
<th style="text-align: right;">the</th>
<th style="text-align: right;">illustration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">80days</td>
<td style="text-align: right;">4,715</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ThousandLeagues</td>
<td style="text-align: right;">8,578</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MysteriousIsland</td>
<td style="text-align: right;">17,003</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">CenterOfTheEarth</td>
<td style="text-align: right;">5,651</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Frankenstein</td>
<td style="text-align: right;">4,195</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mathilda</td>
<td style="text-align: right;">2,214</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">The Last Man</td>
<td style="text-align: right;">11,494</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falkner</td>
<td style="text-align: right;">7,222</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There’ also nothing particularly special about any two words chosen words in each book. Ideally we’d be representing each book with the <em>entire</em> word vector.</p>
<section id="getting-the-whole-term-document-matrix-python-time" class="level3">
<h3 class="anchored" data-anchor-id="getting-the-whole-term-document-matrix-python-time">Getting the whole term-document matrix: python time</h3>
<p>Right now, I have Counter dictionaries for each book stored like this:</p>
<pre><code># This is pseudocode
author_words = {
  book: {w1: c1,
         w2: c2,
         ...},
  ...
}</code></pre>
<p>To get the complete term-document matrix, I’m going to have to:</p>
<ul>
<li><p>combine the words from each dictionary into one big set</p></li>
<li><p>get the count of each word in each dictionary.</p></li>
</ul>
<p>I’ll then convert the lists I get into one big numpy matrix.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are some ways to make term-document matrices with the <code>nltk</code> or <code>scikit-learn</code> that don’t involve writing so much code, but they also don’t show how they work as explicitly as the code below. So for the purpose of teaching, I’m writing it all out long-hand.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, I’ll get a list of the book titles, since this will be handy for making tables later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>book_titles <span class="op">=</span> [book <span class="cf">for</span> book <span class="kw">in</span> shelley_words] <span class="op">+</span> [book <span class="cf">for</span> book <span class="kw">in</span> verne_words]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>book_titles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Frankenstein', 'Mathilda', 'The Last Man', 'Falkner', '80days', 'ThousandLeagues', 'MysteriousIsland', 'CenterOfTheEarth']</code></pre>
</div>
</div>
<p>I need to get one big vocabulary that has just one entry per word that appears in <em>all</em> of the books. I’m using <a href="https://www.w3schools.com/python/python_sets.asp">python sets</a> to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with empty set</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>big_vocab<span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For every book in Shelley's works, </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the Union of `big_vocab` and that book's vocabulary.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> book <span class="kw">in</span> shelley_words:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  this_vocab <span class="op">=</span> <span class="bu">set</span>(shelley_words[book].keys())</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  big_vocab <span class="op">=</span> big_vocab.union(this_vocab)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat for Jules Verne</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> book <span class="kw">in</span> verne_words:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  this_vocab <span class="op">=</span> <span class="bu">set</span>(verne_words[book].keys())</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  big_vocab <span class="op">=</span> big_vocab.union(this_vocab)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the set to a list so that we can index it normally</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>big_vocab <span class="op">=</span> <span class="bu">list</span>(big_vocab)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Total vocab size:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The total vocabulary size is </span><span class="sc">{</span><span class="bu">len</span>(big_vocab)<span class="sc">:,}</span><span class="ss"> words"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The total vocabulary size is 24,681 words</code></pre>
</div>
</div>
<p>Here, I create a list of each word’s frequency in each book, then convert it all to a numpy matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>word_counts <span class="op">=</span> []</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word <span class="kw">in</span> big_vocab:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  document_vector <span class="op">=</span> [shelley_words[book][word] <span class="cf">for</span> book <span class="kw">in</span> shelley_words] <span class="op">+\</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                      [verne_words[book][word] <span class="cf">for</span> book <span class="kw">in</span> verne_words]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  word_counts.append(document_vector)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>word_matrix <span class="op">=</span> np.array(word_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s double check what this matrix looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(word_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 0  0  0 ...  0  2  0]
 [ 0  0  1 ...  0  1  0]
 [ 0  1  1 ...  0  1  0]
 ...
 [ 0  2  0 ...  0  0  0]
 [92  3  0 ...  0  0  0]
 [ 7  1  0 ...  0  0  0]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>word_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(24681, 8)</code></pre>
</div>
</div>
<p>So, there are 24,681 rows, and 8 columns in the matrix. So 1 row for each word, 1 column for each book. We can double check that the numbers look like we expect by getting the indices for specific words, and slicing the term-document matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>example_words <span class="op">=</span> [<span class="st">"the"</span>, <span class="st">"illustration"</span>, <span class="st">"monster"</span>, <span class="st">"sea"</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>example_idx <span class="op">=</span> [big_vocab.index(w) <span class="cf">for</span> w <span class="kw">in</span> example_words]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(word_matrix[example_idx, :])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 4195  2214 11494  7222  4715  8578 17003  5651]
 [    0     0     0     0     1    12     0     4]
 [   31     3     2     2     0    44     8    19]
 [   34    20   118    31    52   357   277   122]]</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Sparse Matrix
</div>
</div>
<div class="callout-body-container callout-body">
<p>Term-document matrices are almost always “sparse” matrices. “Sparse” meaning a <em>lot</em> of its values are 0. We can calculate how many cells of this matrix have counts greater than zero with some numpy tricks.</p>
<p>First, we say <code>word_matrix&gt;0</code>, it will give us back a matrix of the same size, with <code>True</code> where the expression is true and <code>False</code> where the expression is false.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>word_matrix<span class="op">&gt;</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[False, False, False, ..., False,  True, False],
       [False, False,  True, ..., False,  True, False],
       [False,  True,  True, ..., False,  True, False],
       ...,
       [False,  True, False, ..., False, False, False],
       [ True,  True, False, ..., False, False, False],
       [ True,  True, False, ..., False, False, False]])</code></pre>
</div>
</div>
<p>The nifty thing is that we can treat a numpy array of <code>True</code> and <code>False</code> like a matrix of <code>1</code> and <code>0</code> values, where <code>True</code> gets converted to <code>1</code> and <code>False</code> gets converted to <code>0</code>. If we just use <code>np.mean()</code> on this <code>True</code>/<code>False</code> matrix, we’ll just get the proportion of values that are greater than 0!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>np.mean(word_matrix<span class="op">&gt;</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.3449515821887282</code></pre>
</div>
</div>
<p>Only about 34% of all cells in the matrix have a count greater than 0! This is a matrix <em>mostly</em> of 0s.</p>
</div>
</div>
</section>
<section id="whats-an-important-word-for-each-document-tfidf" class="level3">
<h3 class="anchored" data-anchor-id="whats-an-important-word-for-each-document-tfidf">What’s an important word <em>for</em> each document (tf–idf)?</h3>
<p>We could start comparing documents with the cosine similarity of their word counts. Here’s how we’d do it for <em>Frankenstein</em> (index <code>0</code>) and <em>Around the world in 80 Days</em> (index 4).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial.distance <span class="im">import</span> cosine</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span> cosine(word_matrix[:,<span class="dv">0</span>], word_matrix[:, <span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8759771803390621</code></pre>
</div>
</div>
<p>Looks like they’re very similar! But then, they <em>would</em>. For most of the words they have in common, those words are going to have very large frequencies.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Frankenstein</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: right;">4,195</td>
</tr>
<tr class="even">
<td style="text-align: left;">and</td>
<td style="text-align: right;">2,976</td>
</tr>
<tr class="odd">
<td style="text-align: left;">i</td>
<td style="text-align: right;">2,846</td>
</tr>
<tr class="even">
<td style="text-align: left;">of</td>
<td style="text-align: right;">2,642</td>
</tr>
<tr class="odd">
<td style="text-align: left;">to</td>
<td style="text-align: right;">2,089</td>
</tr>
<tr class="even">
<td style="text-align: left;">my</td>
<td style="text-align: right;">1,776</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: right;">1,391</td>
</tr>
<tr class="even">
<td style="text-align: left;">in</td>
<td style="text-align: right;">1,128</td>
</tr>
<tr class="odd">
<td style="text-align: left;">was</td>
<td style="text-align: right;">1,021</td>
</tr>
<tr class="even">
<td style="text-align: left;">that</td>
<td style="text-align: right;">1,018</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">80days</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: right;">4,715</td>
</tr>
<tr class="even">
<td style="text-align: left;">and</td>
<td style="text-align: right;">1,909</td>
</tr>
<tr class="odd">
<td style="text-align: left;">of</td>
<td style="text-align: right;">1,814</td>
</tr>
<tr class="even">
<td style="text-align: left;">to</td>
<td style="text-align: right;">1,696</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: right;">1,330</td>
</tr>
<tr class="even">
<td style="text-align: left;">in</td>
<td style="text-align: right;">1,056</td>
</tr>
<tr class="odd">
<td style="text-align: left;">was</td>
<td style="text-align: right;">1,005</td>
</tr>
<tr class="even">
<td style="text-align: left;">he</td>
<td style="text-align: right;">989</td>
</tr>
<tr class="odd">
<td style="text-align: left;">his</td>
<td style="text-align: right;">858</td>
</tr>
<tr class="even">
<td style="text-align: left;">fogg</td>
<td style="text-align: right;">646</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We want to treat frequent words in each document as <em>important</em> for characterizing that document, while at the same time not giving too much weight to words that are frequent in <em>every</em> document. In comes “tf–idf”.</p>
<section id="tfidf" class="level4">
<h4 class="anchored" data-anchor-id="tfidf">Tf–idf</h4>
<p>“Tf–idf” stands for “term frequency-inverse document frequency”. Annoyingly, the “–” in its name is a <em>hyphen</em>, so we’re not doing subtraction.</p>
<p>“Term frequency” is the frequency of each word within each document. It’s really just the <code>word_matrix</code> we’ve already made. Except we take the log-transform of the frequency.</p>
<p>We’ve looked at the log transform before, but just to remind you, it has the effect of squashing down the right side of a distribution, and stretching out the left side of a distribution.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02_vectors_examples_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="02_vectors_examples_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p><em>But</em> remember how most of the numbers in <code>word_matrix</code> are 0?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.log10(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-inf

&lt;string&gt;:1: RuntimeWarning: divide by zero encountered in log10</code></pre>
</div>
</div>
<p>So, what we do to fix this is add 1 to every value (yes, again) and take the log10 of that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tf <span class="op">=</span> np.log10(word_matrix <span class="op">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, for every word we get a count of how many documents it appeared in. So, “the” appeared in all 8 books, so it will have a document frequency of 8. “Illustration” only appeared in 3 books, so it will have a document frequency of 3.</p>
<p>We can use another handy feature of numpy, and tell it to sum across the columns (<code>axis=1</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> np.<span class="bu">sum</span>(word_matrix <span class="op">&gt;</span> <span class="dv">0</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(24681,)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([2, 2, 4, ..., 1, 3, 2])</code></pre>
</div>
</div>
<p>But the measure we use is <em>inverse</em> document frequency. For that, we actually do <span class="math inline">\(\frac{N}{df}\)</span> where <span class="math inline">\(N\)</span> is the total number of documents. And then, for good measure, we also take the log10 transform.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> np.log10(<span class="dv">8</span><span class="op">/</span>df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get the tf-idf, we just multiply each book’s term frequency vector by the inverse document frequency vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tf_idf <span class="op">=</span> tf <span class="op">*</span> idf[:, np.newaxis]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-upshot" class="level4">
<h4 class="anchored" data-anchor-id="the-upshot">The upshot</h4>
<p>After all of this, we have a measure for each word within each book that balances out its frequency in <em>this</em> book and its appearance frequency across all books.</p>
<table class="table">
<colgroup>
<col style="width: 41%">
<col style="width: 39%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>tf</th>
<th>idf</th>
<th>tf-idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Frequent word in this book (large tf)</td>
<td>Appears in most books (small idf)</td>
<td>Mediocre tf-idf</td>
</tr>
<tr class="even">
<td>Infrequent word in this book (small tf)</td>
<td>Appears in most books (small idf)</td>
<td>Very small tf-idf</td>
</tr>
<tr class="odd">
<td>Frequent word in this book (large tf)</td>
<td>Appears in very few books (large idf)</td>
<td>Large tf-idf</td>
</tr>
</tbody>
</table>
</section>
<section id="the-results" class="level4">
<h4 class="anchored" data-anchor-id="the-results">The Results</h4>
<p>Let’s explore these tf-idf values. First, we can get the indicies of the words in each book with the largest tf-idf values with <code>.argmax(axis=0)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>largest_tfidf <span class="op">=</span> tf_idf.argmax(axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>largest_tfidf_words <span class="op">=</span> [big_vocab[x] <span class="cf">for</span> x <span class="kw">in</span> largest_tfidf]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="table">
<tbody>
<tr class="odd">
<td style="text-align: left;">Frankenstein</td>
<td style="text-align: left;">clerval</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mathilda</td>
<td style="text-align: left;">mathilda</td>
</tr>
<tr class="odd">
<td style="text-align: left;">The Last Man</td>
<td style="text-align: left;">raymond</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falkner</td>
<td style="text-align: left;">falkner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80days</td>
<td style="text-align: left;">fogg</td>
</tr>
<tr class="even">
<td style="text-align: left;">ThousandLeagues</td>
<td style="text-align: left;"><em>nautilus</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;">MysteriousIsland</td>
<td style="text-align: left;">pencroft</td>
</tr>
<tr class="even">
<td style="text-align: left;">CenterOfTheEarth</td>
<td style="text-align: left;">hans</td>
</tr>
</tbody>
</table>
<p>We can get the indicies of the top 5 using <code>.argsort()</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>top_five <span class="op">=</span> (tf_idf <span class="op">*</span> <span class="op">-</span><span class="dv">1</span>).argsort(axis <span class="op">=</span> <span class="dv">0</span>)[<span class="dv">0</span>:<span class="dv">5</span>, :]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>top_five_words <span class="op">=</span> np.empty(shape <span class="op">=</span> (<span class="dv">5</span>,<span class="dv">8</span>), dtype <span class="op">=</span> <span class="st">'object'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(top_five.shape[<span class="dv">0</span>]):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(top_five.shape[<span class="dv">1</span>]):</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    top_five_words[i,j] <span class="op">=</span> big_vocab[top_five[i,j]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Frankenstein</th>
<th style="text-align: left;">Mathilda</th>
<th style="text-align: left;">The Last Man</th>
<th style="text-align: left;">Falkner</th>
<th style="text-align: left;">80days</th>
<th style="text-align: left;">ThousandLeagues</th>
<th style="text-align: left;">MysteriousIsland</th>
<th style="text-align: left;">CenterOfTheEarth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">clerval</td>
<td style="text-align: left;">mathilda</td>
<td style="text-align: left;">raymond</td>
<td style="text-align: left;">falkner</td>
<td style="text-align: left;">fogg</td>
<td style="text-align: left;"><em>nautilus</em></td>
<td style="text-align: left;">pencroft</td>
<td style="text-align: left;">hans</td>
</tr>
<tr class="even">
<td style="text-align: left;">justine</td>
<td style="text-align: left;">_f</td>
<td style="text-align: left;">adrian</td>
<td style="text-align: left;">neville</td>
<td style="text-align: left;">passepartout</td>
<td style="text-align: left;">ned</td>
<td style="text-align: left;">harding</td>
<td style="text-align: left;">sneffels</td>
</tr>
<tr class="odd">
<td style="text-align: left;">safie</td>
<td style="text-align: left;"><em>mathilda</em></td>
<td style="text-align: left;">perdita</td>
<td style="text-align: left;">osborne</td>
<td style="text-align: left;">phileas</td>
<td style="text-align: left;">conseil</td>
<td style="text-align: left;">neb</td>
<td style="text-align: left;">hardwigg</td>
</tr>
<tr class="even">
<td style="text-align: left;">agatha</td>
<td style="text-align: left;">woodville</td>
<td style="text-align: left;">idris</td>
<td style="text-align: left;">boyvill</td>
<td style="text-align: left;">aouda</td>
<td style="text-align: left;">aronnax</td>
<td style="text-align: left;">spilett</td>
<td style="text-align: left;">saknussemm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dæmon</td>
<td style="text-align: left;">a_</td>
<td style="text-align: left;">evadne</td>
<td style="text-align: left;">raby</td>
<td style="text-align: left;">detective</td>
<td style="text-align: left;">nemo</td>
<td style="text-align: left;">reporter</td>
<td style="text-align: left;">icelandic</td>
</tr>
</tbody>
</table>
<p>We can even calculate the cosine similarity of each book from every other book with these tf-idf vectors.</p>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial.distance <span class="im">import</span> cosine</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> np.empty(shape <span class="op">=</span> (<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>):</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    dists[i,j] <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>cosine(tf_idf[:, i], tf_idf[:, j])</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(dists, headers<span class="op">=</span>book_titles, showindex<span class="op">=</span>book_titles,floatfmt<span class="op">=</span><span class="st">".2f"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Frankenstein</th>
<th style="text-align: right;">Mathilda</th>
<th style="text-align: right;">The Last Man</th>
<th style="text-align: right;">Falkner</th>
<th style="text-align: right;">80days</th>
<th style="text-align: right;">ThousandLeagues</th>
<th style="text-align: right;">MysteriousIsland</th>
<th style="text-align: right;">CenterOfTheEarth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Frankenstein</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="even">
<td>Mathilda</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.04</td>
</tr>
<tr class="odd">
<td>The Last Man</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="even">
<td>Falkner</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td>80days</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td>ThousandLeagues</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td>MysteriousIsland</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="even">
<td>CenterOfTheEarth</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="term-context-matrix" class="level2">
<h2 class="anchored" data-anchor-id="term-context-matrix">Term-context matrix</h2>
<p>Term-document matrices can be useful for classifying and describing documents, but if we wanted to come up with vector representations to describe <em>words</em>, we need to build a term-context matrix. The basic intuition behind most vector-semantics draws from the Distributional Hypothesis <span class="citation" data-cites="harris1954">(<a href="#ref-harris1954" role="doc-biblioref">Harris 1954</a>)</span>, which we can illustrate like this.</p>
<p>Try to come up with words that you think are likely to appear in the blank:</p>
<ul>
<li>The elderly __ spoke.</li>
</ul>
<p>Now do the same thing with this phrase:</p>
<ul>
<li>The playful __ jumped.</li>
</ul>
<p>You probably came up with different sets of words in each context. The idea here is that certain words are more <em>likely</em> to appear in certain contexts, and the more contexts two words share, the more similar they are.</p>
<section id="a-quick-and-dirty-term-context-matrix" class="level3">
<h3 class="anchored" data-anchor-id="a-quick-and-dirty-term-context-matrix">A quick and dirty term-context matrix</h3>
<p>We’ll build a quick and dirty term-context matrix with Frankenstein. Often people exclude “stopwords”, like function words at this stage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(mary_shelley_files[<span class="dv">0</span>], <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> f.read()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>unigrams <span class="op">=</span> RegexpTokenizer(<span class="vs">r"\w+"</span>).tokenize(text.replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>).lower())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To build a term-context matrix, we basically look at a “concordance” of every word in the book. We set a context size of some number of words preceding and some number of words following the target word, and then pull those examples out. Let’s do that for “monster.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>context_size <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(context_size, <span class="bu">len</span>(unigrams)<span class="op">-</span>context_size):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> unigrams[idx] <span class="op">==</span> <span class="st">"monster"</span>:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    full_context <span class="op">=</span> unigrams[idx<span class="op">-</span>context_size : idx<span class="op">+</span><span class="dv">1</span><span class="op">+</span>context_size]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(full_context)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['wretch', 'the', 'miserable', 'monster', 'whom', 'i', 'had']
['to', 'behold', 'this', 'monster', 'but', 'i', 'feared']
['imagined', 'that', 'the', 'monster', 'seized', 'me', 'i']
['form', 'of', 'the', 'monster', 'on', 'whom', 'i']
['i', 'was', 'the', 'monster', 'that', 'he', 'said']
['fear', 'lest', 'the', 'monster', 'whom', 'i', 'had']
['remaining', 'friends', 'abhorred', 'monster', 'fiend', 'that', 'thou']
['in', 'reality', 'the', 'monster', 'that', 'i', 'am']
['i', 'then', 'a', 'monster', 'a', 'blot', 'upon']
['you', 'form', 'a', 'monster', 'so', 'hideous', 'that']
['only', 'a', 'detestable', 'monster', 'that', 'is', 'indeed']
['go', 'he', 'cried', 'monster', 'ugly', 'wretch', 'you']
['with', 'me', 'hideous', 'monster', 'let', 'me', 'go']
['and', 'let', 'the', 'monster', 'depart', 'with', 'his']
['promise', 'fulfilled', 'the', 'monster', 'would', 'depart', 'for']
['but', 'that', 'the', 'monster', 'followed', 'me', 'and']
['my', 'rage', 'the', 'monster', 'saw', 'my', 'determination']
['on', 'whom', 'the', 'monster', 'might', 'satisfy', 'his']
['fingers', 'of', 'the', 'monster', 'already', 'grasping', 'my']
['eyes', 'of', 'the', 'monster', 'as', 'i', 'first']
['me', 'and', 'the', 'monster', 'of', 'my', 'creation']
['happy', 'if', 'the', 'monster', 'executed', 'his', 'threat']
['magic', 'powers', 'the', 'monster', 'had', 'blinded', 'me']
['face', 'of', 'the', 'monster', 'he', 'seemed', 'to']
['their', 'cause', 'the', 'monster', 'whom', 'i', 'had']
['to', 'seize', 'the', 'monster', 'be', 'assured', 'that']
['cursed', 'and', 'hellish', 'monster', 'drink', 'deep', 'of']
['information', 'a', 'gigantic', 'monster', 'they', 'said', 'had']
['apparition', 'of', 'the', 'monster', 'seen', 'from', 'our']
['connected', 'such', 'a', 'monster', 'has', 'then', 'really']
['my', 'lips', 'the', 'monster', 'continued', 'to', 'utter']</code></pre>
</div>
</div>
<p>Here, we’ll call <code>monster</code> the target, or $w$, and every other word in the context a context word, or <span class="math inline">\(c\)</span>. To build a term-context matrix, we would need a row of the matrix to be dedicated to the word <code>monster</code>, and columns for every possible word that could occur around <code>monster</code>. We’d then go and add 1 to the relevant column each time we saw a word in the context of <code>monster</code>.</p>
<p>To do this in practice, we need to get a vocuabulary of unique words that appear in the book, and also convenient ways to convert a word string into an index, and a convenient way to convert an index to a word.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>vocabulary <span class="op">=</span> <span class="bu">set</span>(unigrams)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>word_to_index <span class="op">=</span> {w:idx <span class="cf">for</span> idx, w <span class="kw">in</span> <span class="bu">enumerate</span>(vocabulary)}</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>index_to_word <span class="op">=</span> {idx:w <span class="cf">for</span> idx, w <span class="kw">in</span> <span class="bu">enumerate</span>(vocabulary)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we need to create a matrix full of zeros with a row and column for each word in the vocabulary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>term_context <span class="op">=</span> np.zeros(shape <span class="op">=</span> (<span class="bu">len</span>(vocabulary), <span class="bu">len</span>(vocabulary)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we just loop through the book, adding 1 to every cell where the target word (in the rows) appears in the context of another word (in the columns).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>context_size <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(context_size, <span class="bu">len</span>(unigrams)<span class="op">-</span>context_size):</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  word <span class="op">=</span> unigrams[i]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  word_index <span class="op">=</span> word_to_index[word]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  prewindow <span class="op">=</span> unigrams[i<span class="op">-</span>context_size : i]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  postwindow <span class="op">=</span> unigrams[i<span class="op">+</span><span class="dv">1</span> : i<span class="op">+</span><span class="dv">1</span><span class="op">+</span>context_size]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  context <span class="op">=</span> prewindow <span class="op">+</span> postwindow</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> c <span class="kw">in</span> context:</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    c_index <span class="op">=</span> word_to_index[c]</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    term_context[word_index, c_index] <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, if the term-document matrix was sparse, this is <em>super</em> sparse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>np.mean(term_context<span class="op">&gt;</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0044127177791784865</code></pre>
</div>
</div>
<p>Let’s get the 5 most common words that appear in the context of “monster”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>monster_idx <span class="op">=</span> word_to_index[<span class="st">"monster"</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>monster_array <span class="op">=</span> term_context[monster_idx, :]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>top_five_monster_idx <span class="op">=</span> (monster_array<span class="op">*-</span><span class="dv">1</span>).argsort()[<span class="dv">0</span>:<span class="dv">5</span>]</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>top_five_monster_word <span class="op">=</span> [index_to_word[idx] <span class="cf">for</span> idx <span class="kw">in</span> top_five_monster_idx]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>top_five_monster_word</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['the', 'i', 'that', 'of', 'me']</code></pre>
</div>
</div>
<p>At this stage, we <em>could</em> just use these raw counts to calculate the cosine similarity between words,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dist_from_monster <span class="op">=</span> []</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(vocabulary)):</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  dist_from_monster.append(cosine(monster_array, term_context[i, :]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>monster_disr_arr <span class="op">=</span> np.array(dist_from_monster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>monster_sim <span class="op">=</span> monster_disr_arr.argsort()[<span class="dv">0</span>:<span class="dv">10</span>]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>monster_sim_word <span class="op">=</span> [index_to_word[idx] <span class="cf">for</span> idx <span class="kw">in</span> monster_sim]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>monster_sim_word</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['monster', 'on', 'which', 'from', 'fiend', 'and', 'in', 'towards', 'at', 'dæmon']</code></pre>
</div>
</div>
</section>
<section id="positive-pointwise-mutual-information" class="level3">
<h3 class="anchored" data-anchor-id="positive-pointwise-mutual-information">Positive Pointwise Mutual Information</h3>
<p>Similar problem as before, with words appearing very similar because very frequent words show up in a lot of contexts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>joint_prob <span class="op">=</span> term_context<span class="op">/</span><span class="bu">sum</span>(term_context)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>word_C <span class="op">=</span> np.<span class="bu">sum</span>(term_context, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>word_prob <span class="op">=</span> word_C <span class="op">/</span> <span class="bu">sum</span>(word_C)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>context_C <span class="op">=</span> np.<span class="bu">sum</span>(term_context, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>context_prob <span class="op">=</span>context_C<span class="op">/</span><span class="bu">sum</span>(context_C)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>joint_exp <span class="op">=</span> np.outer(word_prob, context_prob)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>PMI <span class="op">=</span> np.log2(joint_prob<span class="op">/</span>joint_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:1: RuntimeWarning: divide by zero encountered in log2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>PMI[PMI <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>monster_array <span class="op">=</span> PMI[monster_idx, :]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>dist_from_monster <span class="op">=</span> []</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(vocabulary)):</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  dist_from_monster.append(cosine(monster_array, PMI[i, :]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>monster_disr_arr <span class="op">=</span> np.array(dist_from_monster)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>monster_sim <span class="op">=</span> monster_disr_arr.argsort()[<span class="dv">0</span>:<span class="dv">10</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>monster_sim_word <span class="op">=</span> [index_to_word[idx] <span class="cf">for</span> idx <span class="kw">in</span> monster_sim]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>monster_sim_word</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['monster', 'let', 'accurate', 'denote', 'wretch', 'neck', 'hellish', 'behold', 'supposition', 'enjoy']</code></pre>
</div>
</div>
</section>
</section>
<section id="doing-it-not-by-hand" class="level2">
<h2 class="anchored" data-anchor-id="doing-it-not-by-hand">Doing it not “by hand”</h2>
<section id="tf-idf" class="level3">
<h3 class="anchored" data-anchor-id="tf-idf">Tf-idf</h3>
<section id="in-python" class="level4">
<h4 class="anchored" data-anchor-id="in-python">In Python</h4>
<p>The key function here is <code>TfidfVectorizer</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is just info and a helper function to read in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mary_shelley_ids <span class="op">=</span> [<span class="dv">84</span>, <span class="dv">15238</span>, <span class="dv">18247</span>, <span class="dv">64329</span>]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mary_shelley_files <span class="op">=</span>  [<span class="ss">f"gen/books/shelley/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span> <span class="cf">for</span> x <span class="kw">in</span> mary_shelley_ids]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>mary_shelley_titles <span class="op">=</span> [<span class="st">"Frankenstein"</span>, <span class="st">"Mathilda"</span>, <span class="st">"The Last Man"</span>, <span class="st">"Falkner"</span>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>jules_verne_ids <span class="op">=</span> [<span class="dv">103</span>, <span class="dv">164</span>, <span class="dv">1268</span>, <span class="dv">18857</span>]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>jules_verne_files <span class="op">=</span> [<span class="ss">f"gen/books/verne/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.txt"</span> <span class="cf">for</span> x <span class="kw">in</span> jules_verne_ids]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>jules_verne_titles <span class="op">=</span> [<span class="st">"80days"</span>, <span class="st">"ThousandLeagues"</span>, <span class="st">"MysteriousIsland"</span>, <span class="st">"CenterOfTheEarth"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>all_files <span class="op">=</span> mary_shelley_files <span class="op">+</span> jules_verne_files</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_and_normalize(path):</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">    will read a document and normalize its text</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> f.read()</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> text.replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">" "</span>).lower()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>The important part</strong>: <code>documents</code> is a with 8 values in it. Each value is a string, and contains the entire text of each book.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> [read_and_normalize(path) <span class="cf">for</span> path <span class="kw">in</span> all_files]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Line 1 sets up the rules we’re going to use for the tf-idf calculation. What <code>TfidfVectorizer</code> does by default does not match the math we did above, and even with these settings, it’s not going to be exactly similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> TfidfVectorizer(smooth_idf <span class="op">=</span> <span class="va">False</span>, sublinear_tf <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> vectorizer.fit_transform(documents)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting <code>tfidf</code> matrix puts the books along the rows and the words along the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>tfidf.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(8, 24645)</code></pre>
</div>
</div>
<p><code>cosine_similarity</code> will do a rowwise comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>similarities <span class="op">=</span> cosine_similarity(tfidf)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.around(similarities, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1.    0.474 0.534 0.562 0.371 0.387 0.405 0.437]
 [0.474 1.    0.429 0.442 0.299 0.314 0.316 0.351]
 [0.534 0.429 1.    0.57  0.349 0.366 0.394 0.397]
 [0.562 0.442 0.57  1.    0.364 0.363 0.385 0.4  ]
 [0.371 0.299 0.349 0.364 1.    0.401 0.401 0.384]
 [0.387 0.314 0.366 0.363 0.401 1.    0.506 0.464]
 [0.405 0.316 0.394 0.385 0.401 0.506 1.    0.488]
 [0.437 0.351 0.397 0.4   0.384 0.464 0.488 1.   ]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at self-similarity</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>shelley_self <span class="op">=</span> similarities[<span class="dv">0</span>:<span class="dv">4</span>, <span class="dv">0</span>:<span class="dv">4</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>shelley_self[np.triu_indices(<span class="dv">4</span>, k <span class="op">=</span> <span class="dv">1</span>)].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.5017177281427782</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at self-similarity</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>verne_self <span class="op">=</span> similarities[<span class="dv">4</span>:<span class="dv">8</span>, <span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>verne_self[np.triu_indices(<span class="dv">4</span>, k <span class="op">=</span> <span class="dv">1</span>)].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.44065120578921735</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at cross-similarity</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>cross_sim <span class="op">=</span> similarities[<span class="dv">0</span>:<span class="dv">4</span>, <span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>cross_sim.mean() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.36861403396731507</code></pre>
</div>
</div>
</section>
<section id="in-r" class="level4">
<h4 class="anchored" data-anchor-id="in-r">In R</h4>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>(I’m using a special R package to access variables that I declared in python)</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>book_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(py<span class="sc">$</span>mary_shelley_ids, py<span class="sc">$</span>jules_verne_ids)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>book_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    84 15238 18247 64329   103   164  1268 18857</code></pre>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>books <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(book_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>books <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gutenberg_id) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> words) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gutenberg_id, words) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(words, gutenberg_id, n) <span class="ot">-&gt;</span> books_tf_idf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>books_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gutenberg_id) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf)) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">gutenberg_id</th>
<th style="text-align: left;">words</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">tf</th>
<th style="text-align: right;">idf</th>
<th style="text-align: right;">tf_idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">84</td>
<td style="text-align: left;">clerval</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="even">
<td style="text-align: right;">84</td>
<td style="text-align: left;">justine</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: right;">84</td>
<td style="text-align: left;">elizabeth</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.981</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: right;">103</td>
<td style="text-align: left;">fogg</td>
<td style="text-align: right;">602</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr class="odd">
<td style="text-align: right;">103</td>
<td style="text-align: left;">passepartout</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.013</td>
</tr>
<tr class="even">
<td style="text-align: right;">103</td>
<td style="text-align: left;">phileas</td>
<td style="text-align: right;">256</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.008</td>
</tr>
<tr class="odd">
<td style="text-align: right;">164</td>
<td style="text-align: left;"><em>nautilus</em></td>
<td style="text-align: right;">509</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr class="even">
<td style="text-align: right;">164</td>
<td style="text-align: left;">ned</td>
<td style="text-align: right;">322</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="odd">
<td style="text-align: right;">164</td>
<td style="text-align: left;">conseil</td>
<td style="text-align: right;">274</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: right;">1268</td>
<td style="text-align: left;">pencroft</td>
<td style="text-align: right;">1050</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.011</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1268</td>
<td style="text-align: left;">harding</td>
<td style="text-align: right;">844</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.009</td>
</tr>
<tr class="even">
<td style="text-align: right;">1268</td>
<td style="text-align: left;">neb</td>
<td style="text-align: right;">455</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.005</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15238</td>
<td style="text-align: left;">_f</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: right;">15238</td>
<td style="text-align: left;"><em>mathilda</em></td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15238</td>
<td style="text-align: left;">mathilda</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="even">
<td style="text-align: right;">18247</td>
<td style="text-align: left;">raymond</td>
<td style="text-align: right;">340</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.004</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18247</td>
<td style="text-align: left;">adrian</td>
<td style="text-align: right;">285</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: right;">18247</td>
<td style="text-align: left;">idris</td>
<td style="text-align: right;">230</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18857</td>
<td style="text-align: left;">hans</td>
<td style="text-align: right;">171</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.004</td>
</tr>
<tr class="even">
<td style="text-align: right;">18857</td>
<td style="text-align: left;">uncle</td>
<td style="text-align: right;">485</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.693</td>
<td style="text-align: right;">0.004</td>
</tr>
<tr class="odd">
<td style="text-align: right;">18857</td>
<td style="text-align: left;">sneffels</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: right;">64329</td>
<td style="text-align: left;">falkner</td>
<td style="text-align: right;">432</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.006</td>
</tr>
<tr class="odd">
<td style="text-align: right;">64329</td>
<td style="text-align: left;">neville</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.079</td>
<td style="text-align: right;">0.004</td>
</tr>
<tr class="even">
<td style="text-align: right;">64329</td>
<td style="text-align: left;">elizabeth</td>
<td style="text-align: right;">470</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">0.981</td>
<td style="text-align: right;">0.003</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>frank <span class="ot">&lt;-</span> books_tf_idf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gutenberg_id <span class="sc">==</span> <span class="dv">84</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(tf_idf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>books_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(gutenberg_id, words, <span class="at">fill=</span><span class="fu">list</span>(<span class="at">tf_idf =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(words) <span class="ot">-&gt;</span> tf_idf_complete</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>tf_idf_complete <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gutenberg_id <span class="sc">==</span> <span class="dv">84</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(tf_idf) <span class="ot">-&gt;</span> frank_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>tf_idf_complete <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gutenberg_id <span class="sc">==</span> <span class="dv">103</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(tf_idf) <span class="ot">-&gt;</span> eighty_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cosine</span>(frank_vector, eighty_vector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] 0.005146954</code></pre>
</div>
</div>



</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-harris1954" class="csl-entry" role="doc-biblioentry">
Harris, Zellig S. 1954. <span>“Distributional Structure.”</span> <em><span><em>WORD</em></span></em> 10 (2-3): 146–62. <a href="https://doi.org/10.1080/00437956.1954.11659520">https://doi.org/10.1080/00437956.1954.11659520</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../lectures/word_vectors/01_concept.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Word Vectors - Concepts</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../lectures/word_vectors/03_word2vec.html" class="pagination-link">
        <span class="nav-page-text">word2vec</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>